function DungeonBoard(n,t,i){function l(n){var t,i;return i=c(n),t=r.findPositionOfType(i),!r.hasPlayer(t.x,t.y)}function e(n){for(var t=r.getAllCharacters(),u=!1,i=t.length;i--;)if(t[i].isPlayer()&&!n||!t[i].isPlayer()&&n){u=!0;break}return u}function a(n,t,i,r){for(var o,f=0,e=u.length;f<e;f++)o=t&&t.isMonsterPlayer()&&t.getControlledMonster()===u[f],n.append(u[f].render(i,r,t&&t.isMonsterPlayer(),o))}function v(){r=new HexagonMap(15,15,0,-1.5,!1,n,t,i,!0);r.addTile(4,0,new HexagonMapTile(new Tile(TileType.DUNGEONEXIT2),0));r.addTile(3,1,new HexagonMapTile(new Tile(TileType.DUNGEONFLOOR),0));r.addTile(4,1,new HexagonMapTile(new Tile(TileType.DUNGEONEXIT3),0));r.addTile(0,2,new HexagonMapTile(new Tile(TileType.DUNGEONEXIT1),0));r.addTile(1,2,new HexagonMapTile(new Tile(TileType.DUNGEONFLOOR),0));r.addTile(2,2,new HexagonMapTile(new Tile(TileType.DUNGEONTRAP),0));r.addTile(3,2,new HexagonMapTile(new Tile(TileType.DUNGEONFLOOR),0));r.addTile(1,3,new HexagonMapTile(new Tile(TileType.DUNGEONTRAP),0));r.addTile(2,3,new HexagonMapTile(new Tile(TileType.DUNGEONFLOOR),0));r.addTile(3,3,new HexagonMapTile(new Tile(TileType.DUNGEONTRAP),0));r.addTile(4,3,new HexagonMapTile(new Tile(TileType.DUNGEONTRAP),0));r.addTile(1,4,new HexagonMapTile(new Tile(TileType.DUNGEONFLOOR),0));r.addTile(2,4,new HexagonMapTile(new Tile(TileType.DUNGEONTREASURE),0));r.addTile(4,4,new HexagonMapTile(new Tile(TileType.DUNGEONEXIT4),0));r.addTile(0,5,new HexagonMapTile(new Tile(TileType.DUNGEONFLOOR),0));r.addTile(1,5,new HexagonMapTile(new Tile(TileType.DUNGEONFLOOR),0));r.addTile(2,5,new HexagonMapTile(new Tile(TileType.DUNGEONFLOOR),0));r.addTile(3,5,new HexagonMapTile(new Tile(TileType.DUNGEONFLOOR),0));r.addTile(0,6,new HexagonMapTile(new Tile(TileType.DUNGEONTRAP),0));r.addTile(0,7,new HexagonMapTile(new Tile(TileType.DUNGEONFLOOR),0));r.addTile(1,7,new HexagonMapTile(new Tile(TileType.DUNGEONEXIT5),0))}function y(){f.setupTraps();f.setupTreasure()}function p(){for(var n=u.length;n--;)u[n].isDead()&&u[n].reset()}function h(){for(var n=u.length;n--;)r.removePlayer(u[n]);for(n=u.length;n--;)r.movePlayerTo(u[n].getStartX(),u[n].getStartY(),u[n])}function c(n){switch(n){case 1:return TileType.DUNGEONEXIT1;case 2:return TileType.DUNGEONEXIT2;case 3:return TileType.DUNGEONEXIT3;case 4:return TileType.DUNGEONEXIT4;case 5:return TileType.DUNGEONEXIT5}throw new Error("Invalid dungeon exit number: "+n);}var r,u,f,o,s;u=[];f=this;v();this.setShowBoard=function(n){o=n};this.setShowMonsterCards=function(n){s=n};this.areEntrancesFree=function(){for(var t=[],n=1;n<=5;n++)t.push(l(n));return t};this.getTileAt=function(n,t){return r.getTileAt(n,t).getTile()};this.getCharacterAt=function(n,t){return r.getTileAt(n,t).getPlayers()[0]};this.playerEnters=function(n,t){var i,u;u=c(t);i=r.findPositionOfType(u);f.movePlayerTo(i.x,i.y,n)};this.isPlayerInDungeon=function(){return e(!1)};this.isMonsterInDungeon=function(){return e(!0)};this.playerLeaves=function(n){r.removePlayer(n);e(!1)||(p(),h(),y(),game.showLastHeroLeavesDungeonTutorial())};this.movePlayerTo=function(n,t,i){i.setIsInDungeon&&i.setIsInDungeon(!0);r.movePlayerTo(n,t,i)};this.getAbsolutePosition=function(n,t){return r.getTileCoords(n-.5,t)};this.render=function(n,t,i,u){n.empty();t.empty();o&&(r.render(n,i,!1,game.clickOnDungeonTile,u,!0),s&&a(t,i,$(t).width(),$(n).height()))};this.markTreasureTaken=function(){var n=r.findPositionOfType(TileType.DUNGEONTREASURE);r.setChip(n.x,n.y,null)};this.markTrapOpen=function(n,t){r.setChip(n,t,ChipType.TRAPOPEN)};this.markTrapRemoved=function(n,t){r.setChip(n,t,null)};this.markNonTrapOpen=function(n,t){r.setChip(n,t,null)};this.checkDeadMonsters=function(){for(var n=u.length;n--;)u[n].isDead()&&r.removePlayer(u[n])};this.setupTraps=function(){var n=[ChipType.TRAPCLOSED,ChipType.TRAPCLOSED,ChipType.NOTRAPCLOSED,ChipType.NOTRAPCLOSED,ChipType.NOTRAPCLOSED];n=Utils.randomizeArray(n);r.setChip(2,2,n[0]);r.setChip(1,3,n[1]);r.setChip(3,3,n[2]);r.setChip(4,3,n[3]);r.setChip(0,6,n[4])};this.setupTreasure=function(){r.setChip(2,4,ChipType.TREASURE)};this.setupMonsters=function(){u=[];var n=Utils.randomizeArray([0,1,2]);u.push(new Monster(MonsterType.ZIPFLER,n[0]));u.push(new Monster(MonsterType.ULUMUTU,n[1]));u.push(new Monster(MonsterType.WALLROG,n[2]));h()};this.showMonsterHearts=function(){for(var n=u.length;n--;)u[n].setDoesShowLives()};this.showMonsterTeeth=function(){for(var n=u.length;n--;)u[n].setDoesShowTeeth()}}function Game(){function dt(){f.showDialog(Dialog.createMissionCardDialog(n),null,{isWithoutBorder:!0,width:811})}function gt(){rr();n.isMonsterPlayer()?ni():ri(n,ni)}function ni(){var f,e;n.removeAllSteps();n.endTurn();e=i.indexOf(n);e===i.length-1?(tt++,ut("game","finishedTurn_"+tt),n=i[0]):(n=i[e+1],tt===0&&(n.isMonsterPlayer()||h.addPlayerToStart(n)));e===0&&tt===0&&(f=u(".playerBoard"),t(TutorialStep.STEP_NEXTPLAYER,f,null,!0),o&&ki());ct();n.resetForNewTurn();r();n.isMonsterPlayer()?(f=u(".playerBoard"),t(TutorialStep.STEP_MONSTERPLAYERTURN,f,null,!0),t(TutorialStep.STEP_MONSTERPLAYERTURN2,f,null,!0)):(rt(),at())}function t(n,t,i,r){if(s.push({tutorialStep:n,x:t.x,y:t.y,onClose:i,forceRight:r}),s.length===1)ti();else if(s.length>1)for(var u=1;u<s.length;u++)d.indexOf(s[u].tutorialStep)<0&&$("#tutorial div.btn").text(tutorial_next)}function ti(){var t=s[0],a=$("#container").outerWidth(),f=255,r=300,e=t.x,h=t.y,v=d.indexOf(t.tutorialStep),i,u,l;if(v>=0){c();return}if(d.push(t.tutorialStep),!o&&t.tutorialStep.isSetup||!ft&&!t.tutorialStep.isSetup){c();return}if($("#tutorial").removeClass(),t.y<f?t.x>a-r||t.forceRight?($("#tutorial").addClass("tr shadowed"),e-=r):$("#tutorial").addClass("tl shadowed"):t.x>a-r||t.forceRight?($("#tutorial").addClass("br shadowed"),e-=r,h-=f):($("#tutorial").addClass("bl shadowed"),h-=f),t.tutorialStep.inFront&&$("#tutorial").addClass("inFront"),$("#tutorial").css("left",e).css("top",h),$("#tutorial").empty(),t.tutorialStep.hasTitle&&$("#tutorial").append($("<h4>").text($.i18n.prop("tutorial_"+t.tutorialStep.ressourceKey+"_title"))),$("#tutorial").append($("<p>").html($.i18n.prop("tutorial_"+t.tutorialStep.ressourceKey+"_text"))),i=t.tutorialStep.isSetup,!i&&s.length>1)for(u=1;u<s.length;u++)d.indexOf(s[u].tutorialStep)<0&&(i=!0);l=$("<div>").addClass("btn").text(i?tutorial_next:tutorial_close).click(function(){c()});t.tutorialStep.noCloseButton&&!i&&l.hide();$("#tutorial").append(l);$("#tutorial").show();t.tutorialStep.isMandatory&&n.toggleStepBox(!1)}function rr(){while(s.length>0)c()}function c(t){if(s.length>0){var i=s[0];if(t&&!i.tutorialStep.inFront)return;i.tutorialStep.isMandatory&&n.toggleStepBox(!0);i.onClose&&i.onClose();s.splice(0,1);s.length>=1?ti():$("#tutorial").hide()}}function ot(n){var t=d.indexOf(n);return t>=0}function ur(n){var t=vt;vt=null;t&&t(n)}function st(n,t){var i=n.removeMissionCard(t);p.returnCard(i)}function ii(n,t){st(n,t);n.addMissionCard(p.getRandomCard(),t)}function ri(n,t){if(n.needsNewMissionCard()){var i=p.getRandomCard();n.pushMissionCard(i);game.showDialog(Dialog.createNewMissionCardDialog(i.getType()),function(){ri(n,t)})}else t()}function ui(){var t,r=null,n;for(e.checkDeadMonsters(),v&&(t=v.getControlledMonster(),t&&t.isDead()&&v.setControlledMonster(null)),n=i.length;n--;)i[n].isMonsterPlayer()||i[n].isDead()&&(r=i[n],i[n].resetForResurrection(),e.playerLeaves(i[n]),h.playerEntersAfterDeath(i[n]));return r}function fr(){for(var n=i.length,t=[];n--;)i[n].hasWonGame(k)&&t.push(i[n]);t.length>0&&(ut("game","finishedGame"),f.showDialog(Dialog.createWinDialog(t),function(){$(window).unbind("beforeunload");f.showDialog(Dialog.createWinDialog2())}))}function ht(){var t=Utils.getRandomNumber(1,6);return t===1?n.addItemToBackpack(new Item(ItemType.BOOT,1)):t===2?n.addItemToBackpack(new Item(ItemType.SWORD,1)):t===3?n.addItemToBackpack(new Item(ItemType.RING,1)):t===4||t===5?n.addPoints(1):t===6&&n.addPoints(2),t}function g(r){var s,c,o;if(e.isPlayerInDungeon()){for(s=w(0,4),t(TutorialStep.STEP_PVP,s,null,!0),c=!0,o=0;o<i.length;o++)if(i[o]!==n&&!i[o].isInDungeon()){c=!1;break}c&&t(TutorialStep.STEP_ALLPVP,s,null,!0)}else v=new Player(PlayerType.MONSTERPLAYER),i.splice(i.indexOf(n)+1,0,v);f.showDialog(Dialog.createEnterDungeonTutorialDialog(),function(){f.showDialog(Dialog.createEnterDungeon2TutorialDialog(),function(){f.showDialog(Dialog.createEnterDungeon3TutorialDialog(),function(){var n=u(".playerPortait:last-child");n&&t(TutorialStep.STEP_MONSTERPLAYER,n)},{isTutorial:!0,dialogKey:"EnterDungeon3"})},{isTutorial:!0,dialogKey:"EnterDungeon2"})},{isTutorial:!0,dialogKey:"EnterDungeon"});h.playerLeaves(n);r&&e.playerEnters(n,r)}function nt(t){e.playerLeaves(n);t&&h.playerEnters(n,t);ct()}function ct(){e.isPlayerInDungeon()&&e.isMonsterInDungeon()||(n===v?(n.setControlledMonster(null),n.removeAllSteps()):v&&(i.splice(i.indexOf(v),1),v=null))}function r(){var k,d,t,f=Math.max(920,$(window).width()-60),o=Math.max(270,$(window).height()-270),u,p,w,b;$("#container").width(f+20);$("#container").height(o+220+10);var s=500,c=300,l=447,v=120,r=f/(s+c+v+0);if(l*r>o?(r=o/l,u=Math.floor((f-(s+c+v)*r)/3),$("#surfaceBoard").css("margin-left",u+"px"),$("#surfaceBoard").css("margin-right",u+10+"px"),$("#monsterCards").css("margin-right",u+"px")):($("#surfaceBoard").css("margin-left","0px"),$("#surfaceBoard").css("margin-right","10px"),$("#monsterCards").css("margin-right","0px")),$("#surfaceBoard").width(Math.floor(s*r)),$("#surfaceBoard").height(399*r),$("#dungeonBoard").width(Math.floor(c*r)),$("#dungeonBoard").height(l*r),$("#monsterCards").width(Math.floor(v*r)),n&&(d=n.isInDungeon()?h.areEntrancesFree():e.areEntrancesFree()),p=n?n.isMonsterPlayer()?!1:n.doesCurrentTileHaveAction(d):!1,k=y.hasCardsLeft(),h.render($("#surfaceBoard"),n,k,p),e.render($("#dungeonBoard"),$("#monsterCards"),n,p),$("#otherPlayers").empty(),kt){for(w=i.length-2,b=!1,t=i.length;t--;)i[t]===n?b=!0:b&&$("#otherPlayers").append(i[t].renderNotActive().addClass("next"+w--));for(t=i.length;t--;)if(i[t]===n)break;else $("#otherPlayers").append(i[t].renderNotActive().addClass("next"+w--))}n&&n.render($("#currentPlayer"),$("#stepButton"));a&&er()}function er(){$("#fade").show();$("#currentPlayer .playerBoard").addClass("showOverFade");$("#currentPlayer .monsterBoard").addClass("showOverFade");$("#defendingCharacter").empty();$("#defendingCharacter").append(a.renderPlayerBoard());var t=$("<div>").addClass("attackButtons"),i=n.isMonsterPlayer()?n.getControlledMonster():n;!n.hasStepsLeft()||a.isDead()||i.isDead()?a.isDead()&&!n.isMonsterPlayer()?t.append($("<div>").addClass("btn").text(fight_takereward_button)).click(function(n){n.stopPropagation();wt()}):t.append($("<div>").addClass("btn").text(fight_close_button)).click(function(n){n.stopPropagation();wt()}):(t.append($("<div>").addClass("btn").text(fight_attack_button).click(function(n){n.stopPropagation();f.clickOnAttack()})),t.append($("<div>").addClass("btn").text(fight_noattack_button).click(function(n){n.stopPropagation();wt()})));$("#defendingCharacter").append(t);$("#defendingCharacter").show()}function wt(){var s,o,y,w,b,v;c(!0);$("#fade").hide();var p=!1,i=n.isMonsterPlayer()?n.getControlledMonster():n,e=a;if(i.setLastFightResults(null,null,null),e.setLastFightResults(null,null,null),(i.isDead()||e.isDead())&&(s=i.isDead()?e:i,o=i.isDead()?i:e,s.isPlayer()&&o.isPlayer()?(y=o.getPoints(),y>s.getPoints()&&(o.setPoints(s.getPoints()),s.setPoints(y))):s.isPlayer()?(s.addPoints(o.getReward()),o.levelUp()):o.removeAllItems(),o.isPlayer()||(w=u(".monsterBoard."+o.getCssClass()),t(TutorialStep.STEP_MONSTERKILLED,w,null,!0)),!e.isPlayer()&&e.isDead()||!i.isPlayer()&&i.isDead())){var h=e.isPlayer()?e:i,k=e.isPlayer()?i:e,l=h.executeMonsterKillMissionsIfAvailable(k);l>=0&&(b=h.getMissionType(l),h===n?(st(h,l),f.showDialog(Dialog.createMissionFulfilledDialog(b))):ii(h,l))}n.isMonsterPlayer()||rt();v=ui();v&&(p=!0,f.showDialog(Dialog.createDeathDialog(v,n===v,i.isPlayer()&&e.isPlayer()),function(){r()}));ct();a=null;$("#defendingCharacter").hide();$("#defendingCharacter").empty();$("#currentPlayer .playerBoard").removeClass("showOverFade");$("#currentPlayer .monsterBoard").removeClass("showOverFade");p||r()}function or(t){var r,u,f;for(l=t.length,k=l===5?12:l===4?14:l===3?16:18,lr(),r=[],u=0,f=t.length;u<f;u++)switch(t[u]){case 1:r.push(PlayerType.JUPANILLIA);break;case 2:r.push(PlayerType.OLOFPAK);break;case 3:r.push(PlayerType.NATHANIEL);break;case 4:r.push(PlayerType.GULANZOR);break;case 5:r.push(PlayerType.LUPHIUS)}i=[];$.each(r,function(n,t){var r=new Player(t);r.pushMissionCard(p.getRandomCard());r.pushMissionCard(p.getRandomCard());r.pushMissionCard(p.getRandomCard());i.push(r)});n=i[0];n.resetForNewTurn()}function sr(){$.each(i,function(n,t){t.setDoesShowLives()})}function hr(){h.addPlayerToStart(i[0])}function cr(){var n=[{type:TileType.VILLAGE,count:1},{type:TileType.GRASS,count:8},{type:TileType.DUNGEON1,count:1},{type:TileType.DUNGEON2,count:1},{type:TileType.DUNGEON3,count:1},{type:TileType.DUNGEON4,count:1},{type:TileType.DUNGEON5,count:1},{type:TileType.FOREST,count:16},{type:TileType.MUSHROOM,count:3},{type:TileType.FISH,count:3},{type:TileType.APPLE,count:3},{type:TileType.CASTLE,count:1},{type:TileType.TRADER,count:1},{type:TileType.SMITH,count:1}];y=new TileStack(n)}function lr(){for(var r=l===2?9:l===3?6:l===4?3:0,u=l===2?3:l===3?2:l===4?1:0,t,i,n=0;n<r;n++)y.removeOneOfType(TileType.FOREST);for(t=[TileType.MUSHROOM,TileType.FISH,TileType.APPLE],n=0;n<u;n++)i=t[Math.floor(Math.random()*t.length)],y.removeOneOfType(i),t.splice(t.indexOf(i),1);y.shuffle()}function ar(){var n=[{type:MissionType.MISSION1,count:1},{type:MissionType.MISSION2,count:1},{type:MissionType.MISSION3,count:1},{type:MissionType.MISSION4,count:1},{type:MissionType.MISSION5,count:1},{type:MissionType.MISSION6,count:1},{type:MissionType.MISSION7,count:1},{type:MissionType.MISSION8,count:1},{type:MissionType.MISSION9,count:1},{type:MissionType.MISSION10,count:2},{type:MissionType.MISSION11,count:2},{type:MissionType.MISSION12,count:2},{type:MissionType.MISSION13,count:1},{type:MissionType.MISSION14,count:1},{type:MissionType.MISSION15,count:1},{type:MissionType.MISSION16,count:1},{type:MissionType.MISSION17,count:1},{type:MissionType.MISSION18,count:1},{type:MissionType.MISSION22,count:2},{type:MissionType.MISSION23,count:4},{type:MissionType.MISSION24,count:2},{type:MissionType.MISSION25,count:2},{type:MissionType.MISSION26,count:2}];p=new MissionStack(n)}function vr(){var n=y.getVillageTile();h=new SurfaceBoard(n,484,386,500);e=new DungeonBoard(295,440,300)}function it(n,t){var i=u("#surfaceBoard"),r=h.getAbsolutePosition(n,t);return{x:i.x+r.x,y:i.y+r.y}}function w(n,t){var i=u("#dungeonBoard"),r=e.getAbsolutePosition(n,t);return{x:i.x+r.x,y:i.y+r.y}}function u(n){var t=$(n);return t.length>0?{x:t.offset().left,y:t.offset().top}:null}function yr(){f.showDialog(Dialog.createWelcomeDialog(),pr)}function pr(){o?ut("start","withTutorial"):ut("start","withoutTutorial");$("#githubButton").show();$("#kickstarterButton").show();$("#contactButton").show();var n=u("#contactButton");t(TutorialStep.SETUP_CONTACT,n,wr)}function wr(){if(h.setShowBoard(!0),o){r();var n=o?it(5,5):null;t(TutorialStep.SETUP_STARTPIECE,n,fi)}else fi()}function fi(){if(e.setShowBoard(!0),o){r();var n=w(0,4);t(TutorialStep.SETUP_DUNGEON,n,ei,!0)}else ei()}function ei(){if(e.setupTraps(),o){r();var n=w(0,6);t(TutorialStep.SETUP_TRAPS,n,oi,!0)}else oi()}function oi(){if(e.setupTreasure(),o){r();var n=w(2,4);t(TutorialStep.SETUP_TREASURE,n,si,!0)}else si()}function si(){if(e.setupMonsters(),o){r();var n=w(0,5);t(TutorialStep.SETUP_MONSTERTOKEN,n,hi,!0)}else hi()}function hi(){if(e.setShowMonsterCards(!0),o){r();var n=u(".monsterBoard:last-child");t(TutorialStep.SETUP_MONSTERCARDS,n,ci,!0)}else ci()}function ci(){if(e.showMonsterTeeth(),o){r();var n=u(".monsterBoard:last-child img.level");t(TutorialStep.SETUP_MONSTERTEETH,n,li,!0)}else li()}function li(){e.showMonsterHearts();r();var n=u(".monsterBoard:last-child img.heart");t(TutorialStep.SETUP_MONSTERHEARTS,n,br,!0)}function br(){f.showDialog(Dialog.createPlayerSelectionDialog(l),function(n){ut("start","playerCount_"+n.length);or(n);kr()})}function kr(){if(hr(),o){r();var n=it(5,5);t(TutorialStep.SETUP_PLAYERTOKEN,n,ai)}else ai()}function ai(){for(var n=i.length,f;n--;)i[n].setFocus(!0);o?(r(),f=u(".playerBoard"),t(TutorialStep.SETUP_PLAYERCARDS,f,vi)):vi()}function vi(){if(sr(),o){r();var n=u(".playerBoard img.heart");t(TutorialStep.SETUP_PLAYERHEARTS,n,yi)}else yi()}function yi(){for(var n=i.length,f;n--;)i[n].setMissionFocus(!0);o?(r(),f=u(".missionPanel"),t(TutorialStep.SETUP_MISSIONCARDS,f,pi,!0)):pi()}function pi(){for(var n=i.length,f;n--;)i[n].setPointsFocus(!0);o?(r(),f=u(".pointLabel"),t(TutorialStep.SETUP_PLAYERPOINTS,f,dr,!0)):wi()}function dr(){f.showDialog(Dialog.createStartDialog(n),function(){wi()})}function wi(){for(var n=i.length,f;n--;)i[n].setHasStepFocus(!0);o?(r(),f=u(".stepBox"),t(TutorialStep.SETUP_ACTIONPOINTS,f,bi,!0)):bi()}function bi(){pt=!1;o||(ki(),gi(),di());r();var n=it(5,5);t(TutorialStep.STEP_MOVEMENT,n)}function ki(){if(kt=!0,o){r();var n=u(".playerPortait:last-child");t(TutorialStep.SETUP_OTHERPLAYERS,n)}}function di(){$("#alchemyButton").show();var n=u("#alchemyButton");t(TutorialStep.SETUP_ALCHEMY,n)}function gi(){$("#helpButton").show();var n=u("#helpButton");t(TutorialStep.SETUP_GUIDE,n)}function lt(){if(!n.hasStepsLeft()){var i=u(".stepBox");t(TutorialStep.STEP_NOSTEPSLEFT,i)}}function rt(){if(n.getPoints()>0){var i=u(".pointLabel");t(TutorialStep.STEP_FIRSTTEETHCOLLECTED,i);n.getPoints()>=k&&t(TutorialStep.STEP_TEETHCOLLECTED,i)}}function nr(){o&&!$("#alchemyButton").is(":visible")&&di()}function gr(){o&&!$("#helpButton").is(":visible")&&gi()}function b(i){var r;i===ItemType.SWORD?(r=u(".swordItem"),t(TutorialStep.STEP_SWORDFOUND,r)):i===ItemType.BOOT?(r=u(".bootItem"),t(TutorialStep.STEP_BOOTFOUND,r)):i===ItemType.RING&&(r=u(".ringItem"),t(TutorialStep.STEP_RINGFOUND,r),nr());!ot(TutorialStep.STEP_POTIONAVAILABLE)&&n.getCreatablePotions().length>0&&(r=u(".potionPlaceholder"),t(TutorialStep.STEP_POTIONAVAILABLE,r));at();ot(TutorialStep.STEP_INVENTORYFULL)||n.hasBackpackSpace()||(r=u(".backpack1Item"),t(TutorialStep.STEP_INVENTORYFULL,r))}function at(){if(!ot(TutorialStep.STEP_MISSIONAVAILABLE)&&n.getFinishableMission()!==null){var i=u(".missionPanel");t(TutorialStep.STEP_MISSIONAVAILABLE,i)}}function tr(n,i){if(!ot(TutorialStep.STEP_LASTTILE)&&!y.hasCardsLeft()){var r=it(n,i);t(TutorialStep.STEP_LASTTILE,r)}}function ut(n,t,i){i===undefined?ga("send","event",{eventCategory:n,eventAction:t},{nonInteraction:1}):ga("send","event",{eventCategory:n,eventAction:t,eventValue:i},{nonInteraction:1})}var l,k,i,n,v,a,y,p,h,e,tt,ir,f,vt,d,yt,o,ft,pt,s,et,bt,kt;l=5;k=12;f=this;d=[];yt=[];i=[];s=[];o=!0;ft=!0;pt=!0;et=null;this.isRunning=function(){return!pt};this.init=function(){tt=0;ir=new Date;ar();cr();vr();r();yr();$(window).bind("resize",function(){clearTimeout(bt);bt=setTimeout(function(){r()},250)});$(window).bind("beforeunload",function(){return $.i18n.prop("game_leave_confirm")});$("body").click(function(){!a&&et&&et.isWithoutBorder&&f.closeDialog()});$("#helpButton").click(function(n){n.stopPropagation();f.clickOnHelpButton()});$("#contactButton").click(function(n){n.stopPropagation();f.clickOnContactButton()});$("#alchemyButton").click(function(n){n.stopPropagation();f.clickOnAlchemyButton()});window.ondragstart=function(){return!1}};this.clickOnTutorialCheckbox=function(n){ft=n;o=n};this.clickOnPlayerTile=function(){var i,f;c();i=n.doCurrentTileAction(function(){r();b()});i.hasType(TileType.DUNGEON1)&&g(1);i.hasType(TileType.DUNGEON2)&&g(2);i.hasType(TileType.DUNGEON3)&&g(3);i.hasType(TileType.DUNGEON4)&&g(4);i.hasType(TileType.DUNGEON5)&&g(5);i.hasType(TileType.DUNGEONEXIT1)&&nt(1);i.hasType(TileType.DUNGEONEXIT2)&&nt(2);i.hasType(TileType.DUNGEONEXIT3)&&nt(3);i.hasType(TileType.DUNGEONEXIT4)&&nt(4);i.hasType(TileType.DUNGEONEXIT5)&&nt(5);r();(i.hasType(TileType.APPLE)||i.hasType(TileType.FISH)||i.hasType(TileType.MUSHROOM))&&(f=u(".playerBoard img.backpack"+n.getLatestBackPackIndex()+"Item"),t(TutorialStep.STEP_FOODAVAILABLE,f),b(i.hasType(TileType.APPLE)?ItemType.APPLE:i.hasType(TileType.FISH)?ItemType.FISH:ItemType.MUSHROOM))};this.clickOnTile=function(i,u){var s,l,e,o,a;c();n.isTeleporting()?(n.isInDungeon()&&nt(),n.removeTeleporting()):n.removeStep();l=h.hasTileAt(i,u);l?(h.movePlayerTo(i,u,n),n.hasWonGame(k)&&(n.removeAllSteps(),fr())):(e=y.getRandomTile(),h.addTileAt(i,u,e),h.movePlayerTo(i,u,n),e.hasType(TileType.FOREST)?(n.removeAllSteps(),r(),s=!0,o=ht(),n.removeAllSteps(),f.showDialog(Dialog.createForestDialog(o),function(){n.handleBackpackOverloadedDialog(function(){r();rt();b(o===1?ItemType.BOOT:o===2?ItemType.SWORD:o===3?ItemType.RING:null);at();tr(i,u);lt()})})):(a=it(i,u),t(TutorialStep.FIELDS[e.getType().name],a),e.hasType(TileType.APPLE)||e.hasType(TileType.FISH)||e.hasType(TileType.MUSHROOM)?nr():(e.hasType(TileType.SMITH)||e.hasType(TileType.TRADER)||e.hasType(TileType.CASTLE))&&gr()));s||(r(),at(),tr(i,u),lt())};this.clickOnDungeonTile=function(i,u){var l,o,s,h,a=!1,v;if(c(),n.isMonsterPlayer())e.movePlayerTo(i,u,n.getControlledMonster()),n.removeStep();else{var k=e.getTileAt(i,u),y=w(i,u),p=!1;n.isTeleporting()?(p=!0,n.isInDungeon()||g(),n.removeTeleporting()):n.removeStep();e.movePlayerTo(i,u,n);n.standsOnChip(ChipType.TRAPCLOSED)?(e.markTrapOpen(i,u),n.recieveDamage(1),n.removeAllSteps(),l=n.executeTrapMissionIfAvailable(),l>=0&&st(n,l),r(),a=!0,v=n.isDead(),f.showDialog(Dialog.createTrapDialog(),function(){function t(){v?f.showDialog(Dialog.createDeathDialog(n,!0,!1),function(){o()}):o()}function o(){e.markTrapRemoved(i,u);r()}l>=0?f.showDialog(Dialog.createMissionFulfilledDialog(MissionType.MISSION22),t):t()}),n.isDead()&&n.removeAllItems(),ui(),ct()):n.standsOnChip(ChipType.NOTRAPCLOSED)?(e.markNonTrapOpen(i,u),t(TutorialStep.STEP_NOTRAP,y,null,!0)):n.standsOnChip(ChipType.TREASURE)&&(r(),a=!0,o=ht(),s=ht(),h=ht(),e.markTreasureTaken(),f.showDialog(Dialog.createTreasureDialog(o,s,h),function(){n.handleBackpackOverloadedDialog(function(){r();rt();b(o===1?ItemType.BOOT:o===2?ItemType.SWORD:o===3?ItemType.RING:null);b(s===1?ItemType.BOOT:s===2?ItemType.SWORD:s===3?ItemType.RING:null);b(h===1?ItemType.BOOT:h===2?ItemType.SWORD:h===3?ItemType.RING:null)})}))}a||r();lt()};this.clickOnControllableMonster=function(t){c();n.setControlledMonster(t);r()};this.clickOnCharacterTile=function(t,i){var u;c();u=e.getCharacterAt(t,i);n.isMonsterPlayer()&&!u.isPlayer()?f.clickOnControllableMonster(u):a=u;r()};this.clickOnAttack=function(){c(!0);var i=n.attack(a),e=i.getCurrentLifes()+1,o=n===i||n.getControlledMonster()===i,s=o?"#currentPlayer":"#defendingCharacter",f=i.isPlayer()?u(s+" .playerBoard .heart"+e):u(s+" .monsterBoard .heart"+e);t(o?TutorialStep.STEP_LOSTLIFESATT:TutorialStep.STEP_LOSTLIFESDEF,{x:f.x+30,y:f.y+30});i==n&&i.isAlmostDead()&&t(TutorialStep.STEP_FEWLIFES,f);r()};this.clickOnDiscardMission=function(t){ii(n,t);n.removeStep();r();lt();dt()};this.clickOnFulfillMission=function(t){var i=n.getMissionType(t),u;c();f.closeDialog();u=Dialog.createMissionFulfilledDialog;(i===MissionType.MISSION7||i===MissionType.MISSION8||i===MissionType.MISSION9)&&(u=Dialog.createMissionFulfilledChooseDialog);game.showDialog(u(i),function(i){n.fulfillMission(t,i);st(n,t);n.handleBackpackOverloadedDialog(function(){r();rt();b()})})};this.clickOnPotion=function(i,f,e){c();n.createPotion(i,f,e);r();var o=u(".potion1Item");t(TutorialStep.STEP_POTIONCREATED,o)};this.clickOnItem=function(t){c();var i=n.useItem(t);i?r():f.showDialog(Dialog.createVoluntaryDiscardDialog(function(){n.discardItem(t);r()},n.getItem(t)),null,{width:320})};this.clickOnNextPlayer=function(){n.hasStepsLeft()?f.showDialog(Dialog.createActionDiscardDialog(function(){gt()}),null,{width:320}):gt()};this.clickOnOtherPlayer=function(n){f.showDialog(Dialog.createOtherPlayerDialog(n),null,{isWithoutBorder:!0,width:400})};this.clickOnMissionCards=function(){dt()};this.clickOnContactButton=function(){f.showDialog(Dialog.createContactDialog())};this.clickOnHelpButton=function(){f.showDialog(Dialog.createGuideDialog(),null,{isWithoutBorder:!0,width:300,right:30})};this.clickOnAlchemyButton=function(){f.showDialog(Dialog.createAlchemyGuideDialog(),null,{isWithoutBorder:!0,width:300,right:30})};this.getTargetTeeth=function(){return k};this.showDialog=function(n,t,i){if(vt=t,et=i,i&&i.isTutorial){if(!ft||yt.indexOf(i.dialogKey)>=0){f.closeDialog();return}yt.push(i.dialogKey)}$("#overlay").empty();$("#overlay").removeClass();$("#overlay").addClass("dialog");i&&i.isWithoutBorder&&$("#overlay").addClass("withoutBorder");i&&i.width?$("#overlay").css("width",i.width+"px"):$("#overlay").css("width","");i&&i.right?$("#overlay").css("margin-right",i.right+"px"):$("#overlay").css("margin-right","");$("#overlay").append(n);$("#fade").show();$("#overlay").show()};this.closeDialog=function(n,t){$("#overlay").hide();a||$("#fade").hide();t&&r();ur(n)};this.showBerserkerTutorial=function(){var n=u(".playerBoard");t(TutorialStep.STEP_BERSERKER,n,null)};this.showTeleportTutorial=function(){var n=u(".playerBoard");t(TutorialStep.STEP_TELEPORT,n,null)};this.showLastHeroLeavesDungeonTutorial=function(){var n=w(0,4);t(TutorialStep.STEP_LASTHEROLEAVESDUNGEON,n,null,!0)}}function HexagonMap(n,t,i,r,u,f,e,o,s){function g(t,i){var r=[];return t>0&&h[t-1][i]&&r.push(h[t-1][i]),t>0&&h[t-1][i+1]&&r.push(h[t-1][i+1]),h[t][i-1]&&r.push(h[t][i-1]),h[t][i+1]&&r.push(h[t][i+1]),t<n-1&&h[t+1][i-1]&&r.push(h[t+1][i-1]),t<n-1&&h[t+1][i]&&r.push(h[t+1][i]),r}function k(n,t){return s?l+(n+i)*1.5*l+9:l-6+(n+i)*p+(t+r)*p/2}function d(n,t){return s?p*(t+r)+(n+i)*(p/2)+38:l+1.5*l*(t+r)}function nt(n,t,i,r){var e,u,f;f=n.getPlayers().length;$.each(n.getPlayers(),function(n,o){var s,h;s=f<=1?0:n%2*25-12;h=f<=2?0:Math.floor(n/2)*25-12;i===o&&(u=new Kinetic.RegularPolygon({x:s,y:h-70,sides:3,radius:12,fill:o.getColor(),stroke:"black",strokeWidth:1,rotation:60,listening:!1}),t.add(u),y!=null&&(y.stop(),y=null),y=new Kinetic.Animation(function(n){b+=n.timeDiff;var t=Math.cos(b/125)*5;u.setPosition({x:s,y:h-70+t})},r),y.start());e=new Kinetic.Rect({x:s-40,y:h-60,width:84,height:84,fillPatternImage:o.getImage(),opacity:1,fillPatternScaleX:.75,fillPatternScaleY:.75,fillPatternRepeat:"no-repeat",stroke:null,strokeWidth:null,strokeEnabled:!1,listening:!1});t.add(e)})}function tt(n,t){return new Kinetic.Circle({x:0,y:0,sides:6,radius:n,fillPatternImage:t.getChipImage(),fillPatternX:28,fillPatternY:28,fillPatternScaleX:.55,fillPatternScaleY:.55,stroke:"black",strokeWidth:.5,listening:!1})}function it(n){return new Kinetic.Circle({x:0,y:0,sides:6,radius:n,fill:"#000",listening:!1})}function rt(n){return new Kinetic.RegularPolygon({x:0,y:0,rotation:s?-30:0,sides:6,radius:n,fill:"#000",listening:!1})}function ut(n,t,i,r,u,f,e){var o=new Kinetic.RegularPolygon({x:0,y:0,sides:6,rotation:(s?-30:0)+(u?u.getAngle():0),radius:r,fill:u?null:"#FFF",opacity:u?1:s?0:.1,fillPatternImage:u&&!s?u.getImage():null,fillPatternX:31,fillPatternY:35,fillPatternScaleX:.44,fillPatternScaleY:.44,stroke:s||u?null:"black",strokeWidth:.5});if(f&&game.isRunning()){o.on("mouseover touchstart",function(){e();s||(u?this.opacity(1):this.opacity(.6),n.draw())});o.on("mouseout touchend",function(){Utils.setDefaultCursor();s||(u?this.opacity(1):this.opacity(.1),n.draw())});o.on("click tap",function(){Utils.setDefaultCursor();s||(u?this.opacity(1):this.opacity(.1),n.draw());f(t,i)})}return o}var c,h,v,y,b=0,l,p,a,w;for(l=35,p=l*Math.sqrt(3),v=this,h=new Array(n),w=n;w--;)h[w]=new Array(t);this.hasPlayer=function(n,t){return h[n][t].hasPlayer()};this.setChip=function(n,t,i){h[n][t].setChip(i)};this.findPositionOfType=function(i){for(var u,f,r=0;r<n;r++)for(u=0;u<t;u++)if(f=h[r][u],f&&f.hasType(i))return{x:r,y:u};return null};this.findPositionOfPlayer=function(i){for(var u,f,r=0;r<n;r++)for(u=0;u<t;u++)if(f=h[r][u],f&&f.containsPlayer(i))return{x:r,y:u};return null};this.getAllCharacters=function(){for(var r,f,u=[],i=0;i<n;i++)for(r=0;r<t;r++)f=h[i][r],f&&(u=u.concat(f.getPlayers()));return u};this.getTileCoords=function(n,t){return{x:a*k(n,t),y:a*d(n,t)}};this.getResurrectPosition=function(){var n=this.findPositionOfType(TileType.DUNGEON1);return n||(n=this.findPositionOfType(TileType.DUNGEON2)),n||(n=this.findPositionOfType(TileType.DUNGEON3)),n||(n=this.findPositionOfType(TileType.DUNGEON4)),n||(n=this.findPositionOfType(TileType.DUNGEON5)),n};this.movePlayerTo=function(n,t,i){v.removePlayer(i);var r=h[n][t];if(r.hasPlayer()&&!u)throw new Error("Only one player allowed on this map.");r.addPlayer(i);i.setCurrentTile(r,g(n,t))};this.removePlayer=function(n){var t=v.findPositionOfPlayer(n),i;t&&(i=h[t.x][t.y],i.removePlayer(n),n.setCurrentTile(null,[]))};this.addTile=function(n,t,i){h[n][t]=i};this.getTileAt=function(n,t){return h[n][t]};this.getWidth=function(){return h.length};this.getHeight=function(){return h[0].length};this.render=function(i,r,o,y,p){var w,b,st,ht,ft,ri,yt,pt,wt,bt,kt,ct,dt,gt,at,g,ni,vt,ui,et,ot,lt,fi,ti,ii;for(a=i.width()/f,c&&(c.destroyChildren(),c.destroy(),c=null),c=new Kinetic.Stage({container:i[0],width:f*a,height:e*a,scaleX:a,scaleY:a}),kt=new Kinetic.Layer,ct=new Kinetic.Layer,dt=new Kinetic.Layer,gt=new Kinetic.Layer,at=new Kinetic.Layer,bt=new Kinetic.Layer,s&&(fi=new Kinetic.Rect({x:0,y:0,width:f,height:e,fillPatternImage:loader.getImage("dungeonboard.jpg"),fillPatternScaleX:.52,fillPatternScaleY:.52,fillPatternRepeat:"no-repeat",stroke:null,strokeWidth:null,strokeEnabled:!1,listening:!1}),bt.add(fi)),r&&r.isMonsterPlayer()?(lt=r.getControlledMonster(),ft=lt?v.findPositionOfPlayer(lt):null):(lt=r,ft=v.findPositionOfPlayer(r)),w=0;w<n;w++)for(b=0;b<t;b++)ni=ft&&w===ft.x&&b===ft.y,vt=ft&&(w===ft.x&&(b===ft.y-1||b===ft.y+1)||w===ft.x-1&&(b===ft.y||b===ft.y+1)||w===ft.x+1&&(b===ft.y-1||b===ft.y)),ui=b>1&&b<9&&!(b===2&&(w<3||w>10))&&!(b===3&&(w<3||w>9))&&!(b===4&&(w<2||w>9))&&!(b===5&&(w<2||w>8))&&!(b===6&&(w<1||w>8))&&!(b===7&&(w<1||w>7))&&!(b===8&&(w<0||w>7)),g=h[w][b],st=k(w,b),ht=d(w,b),(g||vt&&ui&&o&&r&&r.hasStepsLeft())&&(yt=new Kinetic.Group({x:st+1,y:ht+2}),pt=new Kinetic.Group({x:st,y:ht}),et=null,ot=null,r&&r.isTeleporting()?g&&!ni&&(u||!g.hasPlayer())&&(et=y,ot=Utils.setTeleportCursor):r&&r.hasStepsLeft()&&(r.isMonsterPlayer()&&g.hasPlayer()&&!g.getPlayers()[0].isPlayer()&&r.getControlledMonster()!==g.getPlayers()[0]?(et=game.clickOnCharacterTile,ot=Utils.setMonsterSelectCursor):vt&&g&&g.hasPlayer()&&!u?(et=game.clickOnCharacterTile,ot=Utils.setAttackCursor):(et=vt&&(!g||!g.hasChip(ChipType.TREASURE)||!r.isMonsterPlayer())&&(u||!g.hasPlayer())?y:null,ot=Utils.setWalkCursor)),et===null&&ni&&p&&(et=game.clickOnPlayerTile,ot=Utils.setActionCursor),g&&!s&&yt.add(rt(l)),ri=ut(ct,w,b,l,g,et,ot),pt.add(ri),s&&g&&g.hasChip()&&(ti=new Kinetic.Group({x:st+1,y:ht+2}),ii=new Kinetic.Group({x:st,y:ht}),ti.add(it(l*.75)),ii.add(tt(l*.75,g)),dt.add(ti),gt.add(ii)),g&&g.getPlayers().length>0&&(wt=new Kinetic.Group({x:st,y:ht}),nt(g,wt,lt,at,r&&r.hasStepsLeft()),at.add(wt)),kt.add(yt),ct.add(pt));s?(c.add(bt),c.add(ct),c.add(dt),c.add(gt)):(c.add(kt),c.add(ct));c.add(at)}}function HexagonMapTile(n,t){var i=[],r=null;this.getAngle=function(){return t};this.setChip=function(n){r=n};this.hasChip=function(n){return n?r===n:r};this.getPlayers=function(){return i};this.hasPlayer=function(){return i.length>0};this.hasOtherPlayerWithPoints=function(n){for(var t=0,r=i.length;t<r;t++)if(i[t]!==n&&i[t].getPoints()>0)return!0;return!1};this.removeOtherPlayerPoint=function(n){for(var t=0,r=i.length;t<r;t++)if(i[t]!==n&&i[t].getPoints()>0){i[t].addPoints(-1);return}};this.containsPlayer=function(n){return i.indexOf(n)>=0};this.addPlayer=function(n){i.push(n)};this.removePlayer=function(n){var t=i.indexOf(n);t>-1&&i.splice(t,1)};this.hasType=function(t){return n.hasType(t)};this.changeType=function(t){n.changeType(t)};this.getImage=function(){return loader.getImage(n.getImageName())};this.getChipImage=function(){return loader.getImage(r.image)};this.getLabel=function(){return n.toString()};this.getTile=function(){return n}}function Item(n,t){this.isMaxLevel=function(){return t===3};this.equals=function(i){return i.hasType(n)&&i.hasLevel(t)};this.hasType=function(t){return n===t};this.hasLevel=function(n){return t===n};this.getLevel=function(){return t};this.changeType=function(t){n=t};this.increaseLevel=function(){if(n!==ItemType.SWORD&&n!==ItemType.BOOT&&n!==ItemType.RING)throw Error("Item type can't be leveled up");if(t>=3)throw Error("Item shouldn't be on level "+t);t++};this.getImageName=function(){return n===ItemType.BOOT||n===ItemType.POTION||n===ItemType.SWORD||n===ItemType.RING?t===1?n.image1:t===2?n.image2:n.image3:n.image}}function Loader(){function o(r){var u=new Image;u.onload=function(){var r=u.src.substring(u.src.lastIndexOf("/")+1);u.src.indexOf("/"+t+"/")>=0&&(r="{lang}"+r);i[r]=u;n.splice(n.indexOf(r),1);f(1-n.length/(Object.keys(i).length+n.length+0));e()};u.src=r}function e(){n.length===0&&r&&u()}var i={},n=["grass.png","forest.png","resource1.png","resource2.png","resource3.png","castle.png","village.png","trader.png","smith.png","dungeon1.png","dungeon2.png","dungeon3.png","dungeon4.png","dungeon5.png","1.jpg","2.jpg","3.jpg","4.jpg","5.jpg","6.jpg","7.jpg","8.jpg","9.jpg","10.jpg","11.jpg","12.jpg","13.jpg","14.jpg","15.jpg","16.jpg","17.jpg","18.jpg","22.jpg","23.jpg","24.jpg","25.jpg","26.jpg","gulanzor_board.jpg","jupanillia_board.jpg","nathaniel_board.jpg","olofpak_board.jpg","luphius_board.jpg","gulanzor.png","jupanillia.png","nathaniel.png","olofpak.png","luphius.png","gulanzorPortrait.jpg","jupanilliaPortrait.jpg","nathanielPortrait.jpg","olofpakPortrait.jpg","luphiusPortrait.jpg","monsterPortrait.jpg","ulumutuPortrait.jpg","wallrogPortrait.jpg","zipflerPortrait.jpg","ulumutu_board.jpg","zipfler_board.jpg","wallrog_board.jpg","ulumutu.png","zipfler.png","wallrog.png","monsterplayer.jpg","dungeonboard.jpg","tooth1.png","tooth2.png","tooth3.png","tooth4.png","tooth5.png","sword1.png","sword2.png","sword3.png","boot1.png","boot2.png","boot3.png","ring1.png","ring2.png","ring3.png","potion1.png","potion2.png","potion2_back.png","potion3.png","potion3_back.png","apple.png","fish.png","mushroom.png","chip_trap.png","chip_notrap.png","chip_treasure.png","chip_back.png","bubblebl.png","bubblebr.png","bubbletl.png","bubbletr.png","character.jpg","character2.jpg","character3.jpg","monster.jpg","nextbuttongreen.png","nextbuttonred.png","dicewhite.png","diceblack.png","dicetreasure.png","MissionCards.png","missionicon.png","symbol_mail.png","symbol_tile.png","symbol_kickstarter.png","potion_placeholder.png","heart.png","guide_alchemy.jpg","guide.jpg","guide_fight.png"],t,r=!1,u,f;this.init=function(i,s,h,c){var l,a;for(t=i,u=h,f=c,s&&(n=[]),$.i18n.properties({name:"text",path:"js/lang/",language:t,mode:"both",callback:function(){r=!0;$("#loading .line1").html(loading_line1);$("#loading .line2").html(loading_line2);e()}}),l=n.length;l--;)a="img/"+n[l].replace("{lang}",t+"/"),o(a)};this.getLanguage=function(){return t};this.getLanguages=function(){return["de","fr","en","es","it","pt","pl","cz","ch","ru","sr"]};this.getImage=function(n){return i[n]}}function Mission(n){this.hasType=function(t){return n===t};this.getType=function(){return n};this.getImageName=function(){return n.image}}function MissionStack(n){var t=[],i=[];$.each(n,function(n,i){for(var r=0;r<i.count;r++)t.push(new Mission(i.type))});t=Utils.randomizeArray(t);this.returnCard=function(n){i.push(n)};this.hasCardsLeft=function(){return t.length>0||i.length>0};this.getRandomCard=function(){return t.length===0&&i.length>0&&(t=t.concat(i),t=Utils.randomizeArray(t),i=[]),t.pop()}}function Monster(n,t){function v(){return n.stats[i].power}function l(){return n.stats[i].lives}var i,r,o,f,u,s,h,e,a,c;u=this;i=t;r=l();o=null;f=[];this.getNeighbourTiles=function(){return f};this.setDoesShowLives=function(){s=!0};this.setLastFightResults=function(n,t,i){e=n;a=t;c=i};this.setDoesShowTeeth=function(){h=!0};this.isPlayer=function(){return!1};this.getCurrentLifes=function(){return r};this.getNameKey=function(){return n.nameKey};this.getName=function(){return $.i18n.prop(n.nameKey)};this.getImage=function(){return loader.getImage(n.tokenImage)};this.getCssClass=function(){return n.cssClass};this.isDead=function(){return r<=0};this.getStartX=function(){return n.x};this.getStartY=function(){return n.y};this.getPortraitImage=function(){return n.portraitImage};this.getColor=function(){return n.color};this.calculatePower=function(){return v()};this.recieveDamage=function(n){r-=n};this.getReward=function(){return i+1};this.levelUp=function(){i<4&&i++};this.reset=function(){r=l()};this.setCurrentTile=function(n,t){o=n;f=t};this.renderPlayerBoard=function(){return u.render()};this.render=function(t,f,o,l){var a,b=!t,y;if(b)a=$("<div>").addClass("monsterBoard shadowed").addClass("clearfix").addClass(n.cssClass),e&&a.append($("<div>").addClass("dice dice"+(c?"White":"Black")+" dice"+e));else{var p=t/120,v=p*.3,w=60*p,k=(f-3*w)/4;a=$("<div>").addClass("monsterBoard shadowed").addClass("clearfix").addClass(n.cssClass).css("width",t+"px").css("height",w+"px").css("margin-top",k+"px");a.css("transform","scale("+v+", "+v+")");a.css("mozTransform","scale("+v+", "+v+")");a.css("msTransform","scale("+v+", "+v+")");a.css("oTransform","scale("+v+", "+v+")");a.css("webkitTransform","scale("+v+", "+v+")");!o||l||u.isDead()||a.addClass("clickable").click(function(){game.clickOnControllableMonster(u)});l&&a.addClass("controlled");u.isDead()&&a.addClass("dead")}if(a.append($("<img>").addClass("board").attr("src","img/"+n.boardImage)),s)for(y=0;y<r;y++)a.append($("<img>").addClass("heart heart"+(y+1)+" shadowed").attr("src","img/heart.png"));if(h)for(y=5-i;y--;)a.append($("<img>").addClass("level level"+(y+1+i)+" shadowed").attr("src","img/tooth"+(y+1+i)+".png"));return a}}function Player(n){function p(){return n===PlayerType.MONSTERPLAYER}function kt(){return ht()>n.backpackCapacity}function dt(){return ht()<n.backpackCapacity}function ht(){var n=0;return n+=u(ItemType.APPLE),n+=u(ItemType.FISH),n+=u(ItemType.MUSHROOM),n+=Math.max(0,u(ItemType.SWORD)-1),n+=Math.max(0,u(ItemType.RING)-1),n+Math.max(0,u(ItemType.BOOT)-1)}function l(n){for(var t=i.length,r=null;t--;)i[t].hasType(n)&&(!r||r.getLevel()<i[t].getLevel())&&(r=i[t]);return r}function b(n){var t=l(n);return t?t.getLevel():0}function gt(){var t=u(ItemType.POTION);return t<n.potionCapacity}function o(n){if(n.hasType(ItemType.BOOT)){var t=b(ItemType.BOOT);t<n.getLevel()&&(r+=n.getLevel()-t)}i.push(n)}function h(n){w+=n}function ri(){return n.steps+b(ItemType.BOOT)}function ui(){return n.power+b(ItemType.SWORD)+v+k}function ct(){return n.magic+b(ItemType.RING)+d}function ni(n){var i=!1;return t&&(n.hasType(MissionType.MISSION1)?i=u(ItemType.SWORD,1)>=1&&t.hasType(TileType.CASTLE):n.hasType(MissionType.MISSION2)?i=u(ItemType.RING,1)>=1&&t.hasType(TileType.CASTLE):n.hasType(MissionType.MISSION3)?i=u(ItemType.BOOT,1)>=1&&t.hasType(TileType.CASTLE):n.hasType(MissionType.MISSION4)?i=u(ItemType.APPLE)>=1&&u(ItemType.MUSHROOM)>=1&&t.hasType(TileType.FOREST):n.hasType(MissionType.MISSION5)?i=u(ItemType.APPLE)>=1&&u(ItemType.FISH)>=1&&t.hasType(TileType.FOREST):n.hasType(MissionType.MISSION6)?i=u(ItemType.FISH)>=1&&u(ItemType.MUSHROOM)>=1&&t.hasType(TileType.FOREST):n.hasType(MissionType.MISSION7)?i=t.hasType(TileType.FISH):n.hasType(MissionType.MISSION8)?i=t.hasType(TileType.MUSHROOM):n.hasType(MissionType.MISSION9)?i=t.hasType(TileType.APPLE):n.hasType(MissionType.MISSION13)?i=t.hasType(TileType.VILLAGE)&&u(ItemType.APPLE)>=2:n.hasType(MissionType.MISSION14)?i=t.hasType(TileType.VILLAGE)&&u(ItemType.MUSHROOM)>=2:n.hasType(MissionType.MISSION15)?i=t.hasType(TileType.VILLAGE)&&u(ItemType.FISH)>=2:n.hasType(MissionType.MISSION16)?i=u(ItemType.POTION,1)&&t.hasType(TileType.GRASS):n.hasType(MissionType.MISSION17)?i=u(ItemType.POTION,1)&&t.hasType(TileType.GRASS):n.hasType(MissionType.MISSION18)?i=u(ItemType.POTION,1)&&t.hasType(TileType.GRASS):n.hasType(MissionType.MISSION23)?i=t.hasOtherPlayerWithPoints(s):n.hasType(MissionType.MISSION24)?i=u(ItemType.APPLE)>=1:n.hasType(MissionType.MISSION25)?i=u(ItemType.FISH)>=1:n.hasType(MissionType.MISSION26)&&(i=u(ItemType.MUSHROOM)>=1)),i}function ft(n,t){for(var r=i.length;r--;)if(i[r].hasType(n)&&(!t||i[r].hasLevel(t)))return r;return-1}function u(n,t){for(var r=i.length,u=0;r--;)i[r].hasType(n)&&(!t||i[r].hasLevel(t))&&u++;return u}function f(n,t){var i=ft(n,t);a(i)}function a(n,t){if(n>=0){var u=i[n];i.splice(n,1);u.hasType(ItemType.BOOT)&&b(ItemType.BOOT)<u.getLevel()&&(r-=u.getLevel()-b(ItemType.BOOT),r<0&&!t&&(r=0))}else throw new Error("Tried to remove not existing item.");}function ti(n,t,i){var r=Math.min(n,t),u=Math.max(n,t);a(u,i);a(r,i)}function lt(n){n===1?o(new Item(ItemType.MUSHROOM)):n===2?o(new Item(ItemType.FISH)):o(new Item(ItemType.APPLE))}function fi(){r-=1}function ei(){v=0;r-=1}function tt(n,i){var u=e[n];u.hasType(MissionType.MISSION1)?(f(ItemType.SWORD,1),h(2)):u.hasType(MissionType.MISSION2)?(f(ItemType.RING,1),h(2)):u.hasType(MissionType.MISSION3)?(f(ItemType.BOOT,1),h(2)):u.hasType(MissionType.MISSION4)?(f(ItemType.APPLE),f(ItemType.MUSHROOM),h(1)):u.hasType(MissionType.MISSION5)?(f(ItemType.APPLE),f(ItemType.FISH),h(1)):u.hasType(MissionType.MISSION6)?(f(ItemType.FISH),f(ItemType.MUSHROOM),h(1)):u.hasType(MissionType.MISSION7)?(i?h(1):o(new Item(ItemType.BOOT,1)),r=0):u.hasType(MissionType.MISSION8)?(i?h(1):o(new Item(ItemType.RING,1)),r=0):u.hasType(MissionType.MISSION9)?(i?h(1):o(new Item(ItemType.SWORD,1)),r=0):u.hasType(MissionType.MISSION10)||u.hasType(MissionType.MISSION11)||u.hasType(MissionType.MISSION12)?h(2):u.hasType(MissionType.MISSION13)?(f(ItemType.APPLE),f(ItemType.APPLE),o(new Item(ItemType.BOOT,1))):u.hasType(MissionType.MISSION14)?(f(ItemType.MUSHROOM),f(ItemType.MUSHROOM),o(new Item(ItemType.SWORD,1))):u.hasType(MissionType.MISSION15)?(f(ItemType.FISH),f(ItemType.FISH),o(new Item(ItemType.RING,1))):u.hasType(MissionType.MISSION16)?(f(ItemType.POTION,1),o(new Item(ItemType.BOOT,2))):u.hasType(MissionType.MISSION17)?(f(ItemType.POTION,1),o(new Item(ItemType.SWORD,2))):u.hasType(MissionType.MISSION18)?(f(ItemType.POTION,1),o(new Item(ItemType.RING,2))):u.hasType(MissionType.MISSION22)?h(2):u.hasType(MissionType.MISSION23)?(h(1),t.removeOtherPlayerPoint(s)):u.hasType(MissionType.MISSION24)?(f(ItemType.APPLE),r+=1):u.hasType(MissionType.MISSION25)?(f(ItemType.FISH),d+=1):u.hasType(MissionType.MISSION26)&&(f(ItemType.MUSHROOM),k+=2)}function oi(){var n=$("<div>").addClass("stepBox"),t=$("<img>").attr("src",r===0?"img/nextbuttonred.png":"img/nextbuttongreen.png");return game.isRunning()&&t.addClass("clickable shadowed").click(function(){game.clickOnNextPlayer()}),n.append(t),r>0&&n.append($("<span>").text(r)),n}function si(n){var t=l(ItemType.SWORD),i=l(ItemType.BOOT),r=l(ItemType.RING);t&&n.append(at(t,"item swordItem"));i&&n.append(at(i,"item bootItem"));r&&n.append(at(r,"item ringItem"));v>0&&n.append($("<img>").attr("src","img/potion2_back.png").addClass("item potion1Item shadowed"));nt&&n.append($("<img>").attr("src","img/potion3_back.png").addClass("item potion1Item shadowed"))}function at(n,t){return $("<img>").attr("src","img/"+n.getImageName()).addClass(t+" shadowed")}function hi(n,t){for(var u=1,f,r=0,e=i.length;r<e;r++)i[r].hasType(ItemType.POTION)&&(n.append(ci(r,u,t)),u++);return t&&gt()&&(f=s.getCreatablePotions(),f.length>0&&!nt&&v===0&&(n.append(li(u,f)),u++)),n}function ci(n,t,r){var f=i[n],u=$("<img>").addClass("item potion"+t+"Item shadowed").attr("src","img/"+f.getImageName());return r&&game.isRunning()&&u.addClass("clickable").click(function(){game.clickOnItem(n)}),u}function li(n){var t=$("<img>").addClass("item potion"+n+"Item potionPlaceholder shadowed").attr("src","img/potion_placeholder.png");return game.isRunning()&&t.addClass("clickable animated").click(function(){game.showDialog(Dialog.createPotionDialog(i,ct(),s.createPotion))}),t}function ai(n,t){for(var e=l(ItemType.SWORD),o=l(ItemType.BOOT),s=l(ItemType.RING),f=1,r=0,u=i.length;r<u;r++)i[r]===e||i[r]===o||i[r]===s||i[r].hasType(ItemType.POTION)||(n.append(vi(r,f,t)),f++)}function vi(n,t,r){var f=i[n],u=$("<img>").addClass("item backpack"+t+"Item shadowed").attr("src","img/"+f.getImageName());return r&&game.isRunning()&&u.addClass("clickable").click(function(){game.clickOnItem(n)}),u}function yi(n){var t,i;if(wt)for(t=0;t<c;t++)i=$("<img>").addClass("heart heart"+(t+1)+" shadowed").attr("src","img/heart.png"),n.append(i)}function pi(){var t=$("<div>").addClass("missionPanel"),n=$("<img>").attr("src","img/MissionCards.png").addClass("shadowed").attr("title",mouseover_mission_cards);return game.isRunning()&&n.addClass("clickable").click(function(n){n.stopPropagation();game.clickOnMissionCards()}),s.getFinishableMission()!==null&&n.addClass("animated"),t.append(n),t}function wi(n){var i=e[n],t=$("<div>").addClass("missionCard shadowed").append($("<p>").text($.i18n.prop("missiontext_"+i.getType().descKey))),u=ni(i),f,o;return u?(f=$("<div>").addClass("fulfillButton clickable animated").attr("title",dialog_mission_finish_title).click(function(t){t.stopPropagation();game.clickOnFulfillMission(n)}),t.append(f)):r>0&&(o=$("<div>").addClass("replaceButton clickable").attr("title",dialog_mission_replace_title).click(function(t){t.stopPropagation();game.clickOnDiscardMission(n)}),t.append(o)),u||(t.append($("<div>").addClass("explainReward").attr("title",dialog_mission_reward_title)),t.append($("<div>").addClass("explainCondition").attr("title",dialog_mission_condition_title))),t.append($("<img>").attr("src","img/"+i.getImageName())),t}var i,e,r,w,c,t,vt,v,k,d,g,nt,it,rt,et,y,s,ot,yt,pt,ut,wt,st,ii,bt;n===PlayerType.MONSTERPLAYER&&(ot=!0,ut=!0);s=this;i=[];e=[];w=0;v=0;d=0;k=0;g=!1;nt=!1;it=!1;rt=!1;et=p();c=n.lives;t=null;vt=[];y=null;this.setFocus=function(n){ot=n};this.setMissionFocus=function(n){yt=n};this.setPointsFocus=function(n){pt=n};this.getCurrentLifes=function(){return c};this.setHasStepFocus=function(n){ut=n};this.setLastFightResults=function(n,t,i){st=n;ii=t;bt=i};this.getHasStepFocus=function(){return ut};this.setDoesShowLives=function(){wt=!0};this.isPlayer=function(){return!0};this.getName=function(){return $.i18n.prop(n.nameKey)};this.getColor=function(){return n.color};this.getCssClass=function(){return n.cssClass};this.getImage=function(){return loader.getImage(n.tokenImage)};this.isTeleporting=function(){return g};this.removeTeleporting=function(){g=!1};this.isMonsterPlayer=function(){return p()};this.getControlledMonster=function(){return y};this.setControlledMonster=function(n){y=n};this.isAlmostDead=function(){return c===1};this.isDead=function(){return c<=0};this.isInDungeon=function(){return et};this.setIsInDungeon=function(n){et=n};this.hasWonGame=function(n){return w>=n&&t&&t.hasType(TileType.VILLAGE)};this.calculatePower=function(){return ui()};this.calculateMagic=function(){return ct()};this.getPoints=function(){return w};this.setPoints=function(n){w=n};this.resetForNewTurn=function(){r=ri();y=null};this.resetForResurrection=function(){c=1;r=0;v=0};this.removeAllItems=function(){i=[]};this.hasStepsLeft=function(){return r>0};this.recieveDamage=function(n){c-=n};this.removeStep=function(){if(r>0)r--;else throw new Error("Removed step without having step left.");};this.removeAllSteps=function(){r=0};this.endTurn=function(){nt=!1;it=!1;rt=!1;k=0;d=0};this.standsOn=function(n){return t.hasType(n)};this.standsOnChip=function(n){return t.hasChip(n)};this.getLatestBackPackIndex=function(){return ht()};this.getPortraitImage=function(){return n.portraitImage};this.handleBackpackOverloadedDialog=function(n){if(kt()){var t=l(ItemType.SWORD),r=l(ItemType.BOOT),u=l(ItemType.RING);game.showDialog(Dialog.createForcedDiscardDialog(i,t,r,u,s.discardItemAndCheckIfOverloaded),n)}else n&&n()};this.hasBackpackSpace=function(){return dt()};this.getMissionType=function(n){return e[n].getType()};this.needsNewMissionCard=function(){return e.length<3};this.addItemToBackpack=function(n){o(n)};this.addMissionCard=function(n,t){e.splice(t,0,n)};this.pushMissionCard=function(n){e.push(n)};this.removeMissionCard=function(n){var t=e[n];return e.splice(n,1),t};this.getCreatablePotions=function(){var n=[];if(gt()){var u=ct(),t=ft(ItemType.APPLE),i=ft(ItemType.FISH),r=ft(ItemType.MUSHROOM);u>=1&&t>=0&&i>=0&&n.push({level:1,i1:t,i2:i});u>=2&&t>=0&&r>=0&&n.push({level:2,i1:t,i2:r});u>=3&&i>=0&&r>=0&&n.push({level:3,i1:i,i2:r})}return n};this.getFinishableMission=function(){for(var i,r,n=0,t=e.length;n<t;n++)if(i=e[n],r=ni(i),r)return n;return null};this.createPotion=function(n,t,i){ti(n,t);o(new Item(ItemType.POTION,i));d=0};this.doCurrentTileAction=function(n){return t.hasType(TileType.MUSHROOM)?lt(1):t.hasType(TileType.FISH)?lt(2):t.hasType(TileType.APPLE)?lt(3):t.hasType(TileType.TRADER)?game.showDialog(Dialog.createTraderDialog(!rt,i,s.changeItemType),function(){s.handleBackpackOverloadedDialog(function(){n()})}):t.hasType(TileType.CASTLE)?game.showDialog(Dialog.createCastleDialog(!it,i,s.improveItemWaiting)):t.hasType(TileType.SMITH)?game.showDialog(Dialog.createSmithDialog(i,s.improveItems)):t.hasType(TileType.DUNGEON1)||t.hasType(TileType.DUNGEON2)||t.hasType(TileType.DUNGEON3)||t.hasType(TileType.DUNGEON4)||t.hasType(TileType.DUNGEON5)?fi():(t.hasType(TileType.DUNGEONEXIT1)||t.hasType(TileType.DUNGEONEXIT2)||t.hasType(TileType.DUNGEONEXIT3)||t.hasType(TileType.DUNGEONEXIT4)||t.hasType(TileType.DUNGEONEXIT5))&&ei(),t};this.addPoints=function(n){h(n)};this.setCurrentTile=function(n,i){t=n;vt=i};this.doesCurrentTileHaveAction=function(n){return t&&(t.hasType(TileType.DUNGEONEXIT1)&&r>0&&n[0]||t.hasType(TileType.DUNGEONEXIT2)&&r>0&&n[1]||t.hasType(TileType.DUNGEONEXIT3)&&r>0&&n[2]||t.hasType(TileType.DUNGEONEXIT4)&&r>0&&n[3]||t.hasType(TileType.DUNGEONEXIT5)&&r>0&&n[4]||t.hasType(TileType.DUNGEON1)&&r>0&&n[0]||t.hasType(TileType.DUNGEON2)&&r>0&&n[1]||t.hasType(TileType.DUNGEON3)&&r>0&&n[2]||t.hasType(TileType.DUNGEON4)&&r>0&&n[3]||t.hasType(TileType.DUNGEON5)&&r>0&&n[4]||dt()&&(t.hasType(TileType.FISH)||t.hasType(TileType.APPLE)||t.hasType(TileType.MUSHROOM))||t.hasType(TileType.SMITH)||t.hasType(TileType.TRADER)||t.hasType(TileType.CASTLE))};this.changeItemType=function(n,t){var r=i[n];a(n);r.changeType(t);o(r);rt=!0};this.improveItems=function(n,t){var r=i[t];ti(n,t,!0);r.increaseLevel();o(r)};this.improveItemWaiting=function(n){var t=i[n];a(n,!0);t.increaseLevel();o(t);r=0;it=!0};this.attack=function(n){var t,i,u,f,e,o;return t=p()?y:s,f=Utils.getRandomNumber(1,6),i=t.calculatePower()+f,e=Utils.getRandomNumber(1,6),u=n.calculatePower()+e,i>=u?(n.recieveDamage(1,t),o=n):(t.recieveDamage(1,n),o=t),t.setLastFightResults(f,i,!0),n.setLastFightResults(e,u,!1),r-=1,k=0,o};this.executeTrapMissionIfAvailable=function(){for(var n=e.length;n--;)if(e[n].hasType(MissionType.MISSION22))return tt(n),n;return-1};this.executeMonsterKillMissionsIfAvailable=function(n){for(var t=e.length,i=n.getNameKey();t--;)if(e[t].hasType(MissionType.MISSION10)&&i===MonsterType.ULUMUTU.nameKey||e[t].hasType(MissionType.MISSION11)&&i===MonsterType.WALLROG.nameKey||e[t].hasType(MissionType.MISSION12)&&i===MonsterType.ZIPFLER.nameKey)return tt(t),t;return-1};this.fulfillMission=function(n,t){return tt(n,t)};this.discardItemAndCheckIfOverloaded=function(n){return a(n),kt()};this.discardItem=function(n){a(n)};this.getItem=function(n){return i[n]};this.useItem=function(t){var r=i[t],u=!1;return r.hasType(ItemType.MUSHROOM)||r.hasType(ItemType.FISH)||r.hasType(ItemType.APPLE)?c<n.lives&&(c++,u=!0):r.hasType(ItemType.POTION)&&(r.hasLevel(1)?c<n.lives&&(c=n.lives,u=!0):r.hasLevel(2)?(v+=3,u=!0,game.showBerserkerTutorial()):g||(g=!0,nt=!0,u=!0,game.showTeleportTutorial())),u&&a(t),u};this.renderNotActive=function(){var t=$("<div>").addClass("playerPortait shadowed").addClass(n.cssClass),i=$("<img>").attr("src","img/"+n.portraitImage);return p()||(t.addClass("clickable"),i.click(function(n){n.stopPropagation();game.clickOnOtherPlayer(s)})),t.append(i),t};this.render=function(n,t){$(n).empty();$(t).empty();ot&&$(n).append(s.renderPlayerBoard(!0));p()||yt&&$(n).append(pi());ut&&t.append(oi())};this.renderOther=function(){return s.renderPlayerBoard(!1)};this.renderPlayerBoard=function(t){var i;return p()&&y!==null?i=y.renderPlayerBoard():(i=$("<div>").addClass("playerBoard shadowed").addClass(n.cssClass),i.addClass(t?"current":"other"),i.append($("<img>").addClass("board").attr("src","img/"+n.boardImage)),p()||(si(i),ai(i,t),hi(i,t),yi(i),pt&&i.append($("<div>").addClass("pointLabel shadowed").append($("<span>").text(w)).append($("<span>").text(game.getTargetTeeth()))),st&&i.append($("<div>").addClass("dice dice"+(bt?"White":"Black")+" dice"+st)))),i};this.toggleStepBox=function(n){n?($(".stepBox img").unbind("click"),$(".stepBox img").removeClass("clickable")):($(".stepBox img").click(function(){game.clickOnNextPlayer()}),$(".stepBox img").addClass("clickable"))};this.renderMissionCards=function(){for(var t=$("<div>").addClass("clearfix"),n=0,i=e.length;n<i;n++)t.append(wi(n));return t}}function SurfaceBoard(n,t,i,r){function l(n){var t;return t=c(n),u.findPositionOfType(t)}function c(n){switch(n){case 1:return TileType.DUNGEON1;case 2:return TileType.DUNGEON2;case 3:return TileType.DUNGEON3;case 4:return TileType.DUNGEON4;case 5:return TileType.DUNGEON5}throw new Error("Invalid dungeon entrance number: "+n);}var u,e,o,f,s,h;s=this;this.setShowBoard=function(n){h=n};o=5;f=5;u=new HexagonMap(15,15,-3,-2,!0,t,i,r,!1);e=new HexagonMapTile(n,0);u.addTile(o,f,e);this.addPlayerToStart=function(n){u.movePlayerTo(f,f,n)};this.addPlayersToStart=function(n){for(var t=n.length-1;t>=0;t--)u.movePlayerTo(f,f,n[t])};this.areEntrancesFree=function(){for(var t=[],n=1;n<=5;n++)t.push(l(n));return t};this.playerEnters=function(n,t){var i,r;r=c(t);i=u.findPositionOfType(r);s.movePlayerTo(i.x,i.y,n)};this.playerEntersAfterDeath=function(n){var t=u.getResurrectPosition();u.movePlayerTo(t.x,t.y,n)};this.playerLeaves=function(n){u.removePlayer(n)};this.hasTileAt=function(n,t){return u.getTileAt(n,t)};this.getAbsolutePosition=function(n,t){return u.getTileCoords(n+.5,t)};this.addTileAt=function(n,t,i){u.addTile(n,t,new HexagonMapTile(i,0))};this.movePlayerTo=function(n,t,i){i.setIsInDungeon(!1);u.movePlayerTo(n,t,i)};this.render=function(n,t,i,r){n.empty();h&&u.render(n,t,i,game.clickOnTile,r,!0)}}function Tile(n){this.hasType=function(t){return n===t};this.getType=function(){return n};this.changeType=function(t){n=t};this.getImageName=function(){return n.image}}function TileStack(n){var t=[];$.each(n,function(n,i){for(var r=0;r<i.count;r++)t.push(new Tile(i.type))});this.removeOneOfType=function(n){for(var i=0;i<t.length;i++)if(t[i].hasType(n)){t.splice(i,1);return}throw new Error("No tile to remove found.");};this.shuffle=function(){t=Utils.randomizeArray(t)};this.hasCardsLeft=function(){return t.length>0};this.getRandomTile=function(){return t.pop()};this.getVillageTile=function(){for(var i,n=0;n<t.length;n++)if(t[n].hasType(TileType.VILLAGE))return i=t[n],t.splice(n,1),i;throw new Error("No VILLAGE found.");}}var ChipType={TREASURE:{image:"chip_treasure.png"},TRAPOPEN:{image:"chip_trap.png"},NOTRAPOPEN:{image:"chip_notrap.png"},TRAPCLOSED:{image:"chip_back.png"},NOTRAPCLOSED:{image:"chip_back.png"}},Dialog={createWelcomeDialog:function(){var t=$("<select>").addClass("dialogSelect").change(function(){$(window).unbind("beforeunload");window.location="http://demo.heldentaufe.ch?lang="+$(this).children(":selected").val()}),n;return $.each(loader.getLanguages(),function(n,i){t.append($("<option>").val(i).text($.i18n.prop("language_name_"+i)).prop("selected",i===loader.getLanguage()))}),n=$("<div>"),n.append($("<img>").addClass("dialogTile").attr("src","img/character.jpg")),n.append(t),n.append($("<h4>").html(dialog_welcome_title)),n.append($("<p>").text(dialog_welcome_text_1)),n.append($("<p>").text(dialog_welcome_text_2)),n.append($("<p>").text(dialog_welcome_text_3)),n.append($("<p>").append($("<input>").attr("type","checkbox").attr("id","withTutorial").prop("checked",!0).click(function(){game.clickOnTutorialCheckbox($(this).prop("checked"))})).append($("<label>").attr("for","withTutorial").text(dialog_welcome_withtutorial))),n.append($("<p>").html(dialog_welcome_warning)),n.append($("<div>").addClass("btn").text(dialog_welcome_start_button).click(function(){game.closeDialog()})),n},createStartDialog:function(n){var t=$("<div>");return t.append($("<img>").addClass("dialogTile").attr("src","img/character2.jpg")),t.append($("<h4>").text(dialog_start_title)),t.append($("<p>").text(dialog_start_text(n.getName()))),t.append($("<div>").addClass("btn").text(dialog_start_start_button).click(function(){game.closeDialog()})),t},createForestDialog:function(n){var t=$("<div>"),i,r;return t.append($("<img>").addClass("dialogTile").attr("src","img/forest.png")),t.append($("<h4>").text(dialog_forest_title)),t.append($("<p>").text(dialog_forest_text)),t.append($("<div>").addClass("btn").attr("id","throwDiceButton").text(dialog_forest_throwdice).click(function(){$("#throwDiceButton").hide();$(".rewards").show();$("#dialogCloseButton").show()})),i=$("<div>").addClass("rewards").hide(),r=$("<div>").addClass("diceTreasure").addClass("dice"+n),i.append(r),t.append(i),t.append($("<div>").addClass("btn").attr("id","dialogCloseButton").text(dialog_forest_takereward).click(function(){game.closeDialog()}).hide()),t},createTreasureDialog:function(n,t,i){var r=$("<div>"),u,f,e,o;return r.append($("<img>").addClass("dialogTile").attr("src","img/chip_treasure.png")),r.append($("<h4>").text(dialog_treasure_title)),r.append($("<p>").text(dialog_treasure_text)),r.append($("<div>").addClass("btn").attr("id","throwDiceButton").text(dialog_treasure_throwdice).click(function(){$("#throwDiceButton").hide();$(".rewards").show();$("#dialogCloseButton").show()})),u=$("<div>").addClass("rewards").hide(),f=$("<div>").addClass("diceTreasure").addClass("dice"+n),u.append(f),e=$("<div>").addClass("diceTreasure").addClass("dice"+t),u.append(e),o=$("<div>").addClass("diceTreasure").addClass("dice"+i),u.append(o),r.append(u),r.append($("<div>").addClass("btn").attr("id","dialogCloseButton").text(dialog_treasure_takereward).click(function(){game.closeDialog()}).hide()),r},createEnterDungeonTutorialDialog:function(){var n=$("<div>");return n.append($("<img>").addClass("dialogTile").attr("src","img/monster.jpg")),n.append($("<h4>").text(dialog_enterdungeon_title)),n.append($("<p>").text(dialog_enterdungeon_text)),n.append($("<p>").text(dialog_enterdungeon_text2)),n.append($("<div>").addClass("btn").attr("id","dialogCloseButton").text(dialog_next).click(function(){game.closeDialog()})),n},createEnterDungeon2TutorialDialog:function(){var n=$("<div>");return n.append($("<h4>").text(dialog_enterdungeon2_title)),n.append($("<p>").text(dialog_enterdungeon2_text)),n.append($("<img>").attr("src","img/guide_fight.png")),n.append($("<p>").text(dialog_enterdungeon2_text2)),n.append($("<div>").addClass("btn").attr("id","dialogCloseButton").text(dialog_next).click(function(){game.closeDialog()})),n},createEnterDungeon3TutorialDialog:function(){var n=$("<div>"),t,i;return n.append($("<h4>").text(dialog_enterdungeon3_title)),t=$("<div>").addClass("clearfix"),t.append($("<img>").addClass("dialogTile alignToP").attr("src","img/chip_back.png")),t.append($("<p>").text(dialog_enterdungeon3_text)),n.append(t),i=$("<div>").addClass("clearfix"),i.append($("<img>").addClass("dialogTile alignToP").attr("src","img/chip_treasure.png")),i.append($("<p>").text(dialog_enterdungeon3_text2)),n.append(i),n.append($("<div>").addClass("btn").attr("id","dialogCloseButton").text(dialog_enterdungeon3_button).click(function(){game.closeDialog()})),n},createSmithDialog:function(n,t){function u(n,i,r,u){var c=$.i18n.prop(i.nameKey),f=e(i,r,u),h=$("<img>").addClass("item").attr("src","img/"+i["image"+r]),o,s;f[0]!==null&&h.addClass("available");o=$("<img>").addClass("item").attr("src","img/"+i["image"+u]);s=$("<img>").addClass("item").attr("src","img/"+i["image"+(u+1)]);f[1]!==null&&(o.addClass("available"),f[0]!==null&&f[1]!==null&&s.addClass("available").addClass("clickable").attr("title",dialog_smith_improve_title(c)).click(function(){t(f[0],f[1]);game.closeDialog(null,!0)}));n.append($("<div>").addClass("actionLine").append(h).append(" + ").append(o).append($("<div>").addClass("arrow-right")).append(s))}function e(t,i,r){for(var f=[null,null],u=0,e=n.length;u<e;u++)n[u].hasType(t)&&n[u].hasLevel(i)&&(f[0]=u);for(u=0,e=n.length;u<e;u++)n[u].hasType(t)&&n[u].hasLevel(r)&&(f[0]===null||f[0]!==u)&&(f[1]=u);return f}var f,r,i;return f=$("<div>").addClass("smith"),f.append($("<img>").addClass("dialogTile").attr("src","img/smith.png")),f.append($("<h4>").text(dialog_smith_title)),f.append($("<p>").text(dialog_smith_text)),i=$("<div>").addClass("actionPanel"),u(i,ItemType.SWORD,1,1),u(i,ItemType.SWORD,1,2),r=e(ItemType.SWORD,2,2),r[0]!==null&&r[1]!=null&&u(i,ItemType.SWORD,2,2),u(i,ItemType.BOOT,1,1),u(i,ItemType.BOOT,1,2),r=e(ItemType.BOOT,2,2),r[0]!==null&&r[1]!=null&&u(i,ItemType.BOOT,2,2),u(i,ItemType.RING,1,1),u(i,ItemType.RING,1,2),r=e(ItemType.RING,2,2),r[0]!==null&&r[1]!=null&&u(i,ItemType.RING,2,2),f.append(i),f.append($("<br>")),f.append($("<div>").addClass("btn").text(dialog_close).click(function(){game.closeDialog()})),f},createTraderDialog:function(n,t,i){function f(n,t,i){var u=o(t,i),f,r;u!==null&&(f=$("<img>").addClass("item").attr("src","img/"+t["image"+i]).addClass("available"),r=[],t!==ItemType.SWORD&&r.push(e(ItemType.SWORD,i,u)),t!==ItemType.BOOT&&r.push(e(ItemType.BOOT,i,u)),t!==ItemType.RING&&r.push(e(ItemType.RING,i,u)),n.append($("<div>").addClass("actionLine").append(r[0]).append($("<div>").addClass("arrow-left")).append(f).append($("<div>").addClass("arrow-right")).append(r[1])))}function o(n,i){for(var r=0,u=t.length;r<u;r++)if(t[r].hasType(n)&&t[r].hasLevel(i))return r;return null}function e(t,r,u){var e=$.i18n.prop(t.nameKey),f=$("<img>").addClass("item").attr("src","img/"+t["image"+r]);return n&&f.attr("title",dialog_trader_switch_title(e)).addClass("clickable").click(function(){i(u,t);game.closeDialog(null)}),f}var u,r;return u=$("<div>").addClass("trader"),u.append($("<img>").addClass("dialogTile").attr("src","img/trader.png")),u.append($("<h4>").text(dialog_trader_title)),u.append($("<p>").text(dialog_trader_text)),n||u.append($("<p>").text(dialog_trader_text_notpossible)),r=$("<div>").addClass("actionPanel"),f(r,ItemType.SWORD,1),f(r,ItemType.BOOT,1),f(r,ItemType.RING,1),f(r,ItemType.SWORD,2),f(r,ItemType.BOOT,2),f(r,ItemType.RING,2),f(r,ItemType.SWORD,3),f(r,ItemType.BOOT,3),f(r,ItemType.RING,3),u.append(r),r.children().length===0&&u.append($("<p>").text(dialog_trader_noitems)),u.append($("<br>")),u.append($("<div>").addClass("btn").text(dialog_close).click(function(){game.closeDialog()})),u},createCastleDialog:function(n,t,i){function f(t,r){var h=$.i18n.prop(r.nameKey),s=e(r,1),c=$("<img>").addClass("item").attr("src","img/"+r.image1),u,f,l,o;s!==null&&c.addClass("available");u=e(r,2);f=$("<img>").addClass("item").attr("src","img/"+r.image2);s!==null&&n&&f.addClass("clickable").attr("title",dialog_castle_improve_title(h)).click(function(){i(s);game.closeDialog(null,!0)});u!==null&&f.addClass("available");l=e(r,3);o=$("<img>").addClass("item").attr("src","img/"+r.image3);u!==null&&n&&o.addClass("clickable").attr("title",dialog_castle_improve_title(h)).click(function(){i(u);game.closeDialog(null,!0)});l!==null&&o.addClass("available");t.append($("<div>").addClass("actionLine").append(c).append($("<div>").addClass("arrow-right")).append(f).append($("<div>").addClass("arrow-right")).append(o))}function e(n,i){for(var r=0,u=t.length;r<u;r++)if(t[r].hasType(n)&&t[r].hasLevel(i))return r;return null}var r,u;return r=$("<div>").addClass("castle"),r.append($("<img>").addClass("dialogTile").attr("src","img/castle.png")),r.append($("<h4>").text(dialog_castle_title)),r.append($("<p>").text(dialog_castle_text)),n||r.append($("<p>").text(dialog_castle_text_notpossible)),u=$("<div>").addClass("actionPanel"),f(u,ItemType.SWORD),f(u,ItemType.BOOT),f(u,ItemType.RING),r.append(u),r.append($("<br>")),r.append($("<div>").addClass("btn").text(dialog_close).click(function(){game.closeDialog()})),r},createPotionDialog:function(n,t,i){function f(n,r,u,f,o){var v=$.i18n.prop(ItemType.POTION.nameKey+"_"+f),h=e(r),a=$("<img>").addClass("item").attr("src","img/"+r.image),s,c,l;h!==null&&a.addClass("available");s=e(u);c=$("<img>").addClass("item").attr("src","img/"+u.image);s!==null&&c.addClass("available");l=$("<img>").addClass("item").attr("src","img/"+ItemType.POTION["image"+f]);h!==null&&s!==null&&t>=f&&l.addClass("available").addClass("clickable").attr("title",dialog_potion_create_item_title(v)).click(function(){i(h,s,f);game.closeDialog(null,!0)});n.append($("<p>").text(o));n.append($("<div>").addClass("actionLine").append(a).append(" + ").append(c).append($("<div>").addClass("arrow-right")).append(l))}function e(t){for(var i=0,r=n.length;i<r;i++)if(n[i].hasType(t))return i;return null}var r,u;return r=$("<div>").addClass("trader"),r.append($("<h4>").text(dialog_potion_create_title)),r.append($("<p>").text(dialog_potion_create_text)),u=$("<div>").addClass("actionPanel"),f(u,ItemType.APPLE,ItemType.FISH,1,dialog_potion_description_1_text),f(u,ItemType.APPLE,ItemType.MUSHROOM,2,dialog_potion_description_2_text),f(u,ItemType.MUSHROOM,ItemType.FISH,3,dialog_potion_description_3_text),r.append(u),r.append($("<br>")),r.append($("<div>").addClass("btn").text(dialog_close).click(function(){game.closeDialog()})),r},createTrapDialog:function(){var n=$("<div>");return n.append($("<img>").addClass("dialogTile").attr("src","img/chip_trap.png")),n.append($("<h4>").text(dialog_trap_title)),n.append($("<p>").text(dialog_trap_text)),n.append($("<div>").addClass("btn").text(dialog_close).click(function(){game.closeDialog()})),n},createMissionFulfilledDialog:function(n){var t=$("<div>"),i=$("<div>").addClass("missionCard").append($("<p>").text($.i18n.prop("missiontext_"+n.descKey))).append($("<img>").addClass("dialogTile").attr("src","img/"+n.image));return t.append(i),t.append($("<h4>").text(dialog_missionfulfilled_title)),t.append($("<p>").text(dialog_missionfulfilled_text)),t.append($("<div>").addClass("btn").text(dialog_next).click(function(){game.closeDialog()})),t},createMissionFulfilledChooseDialog:function(n){var t=$("<div>"),i=$("<div>").addClass("missionCard").append($("<p>").text($.i18n.prop("missiontext_"+n.descKey))).append($("<img>").addClass("dialogTile").attr("src","img/"+n.image));return t.append(i),t.append($("<h4>").text(dialog_missionfulfilled_title)),t.append($("<p>").text(dialog_missionfulfilledchoose_text)),t.append($("<div>").addClass("btn").text(dialog_missionfulfilledchoose_option1).click(function(){game.closeDialog(!1)})),t.append($("<div>").addClass("btn").text(dialog_missionfulfilledchoose_option2).click(function(){game.closeDialog(!0)})),t},createNewMissionCardDialog:function(n){var t=$("<div>"),i=$("<div>").addClass("missionCard").append($("<p>").text($.i18n.prop("missiontext_"+n.descKey))).append($("<img>").addClass("dialogTile").attr("src","img/"+n.image));return t.append(i),t.append($("<h4>").text(dialog_newmissioncard_title)),t.append($("<p>").text(dialog_newmissioncard_text)),t.append($("<div>").addClass("btn").text(dialog_close).click(function(){game.closeDialog()})),t},createDeathDialog:function(n,t,i){var r=$("<div>");return t?r.append($("<h4>").text(dialog_death_title_current)):r.append($("<h4>").text(dialog_death_title_other(n.getName()))),r.append($("<p>").text(dialog_death_text)),i?r.append($("<p>").text(dialog_death_text_byplayer)):r.append($("<p>").text(dialog_death_text_bymonster)),r.append($("<div>").addClass("btn").text(dialog_close).click(function(){game.closeDialog()})),r},createVoluntaryDiscardDialog:function(n,t){var i=$("<div>");return i.append($("<h4>").text(dialog_voluntarydiscard_title)),t.hasType(ItemType.APPLE)||t.hasType(ItemType.FISH)||t.hasType(ItemType.MUSHROOM)?i.append($("<p>").text(dialog_voluntarydiscard_text_resource)):t.hasType(ItemType.POTION)&&(t.hasLevel(1)?i.append($("<p>").text(dialog_voluntarydiscard_text_potion1)):t.hasLevel(2)?i.append($("<p>").text(dialog_voluntarydiscard_text_potion2)):i.append($("<p>").text(dialog_voluntarydiscard_text_potion3))),i.append($("<img>").addClass("item discardable").attr("src","img/"+t.getImageName())),i.append($("<p>").text(dialog_voluntarydiscard_text)),i.append($("<div>").addClass("btnPanel clearfix").append($("<div>").addClass("btn leftAligned").text(dialog_yes).click(function(){game.closeDialog();n()})).append($("<div>").addClass("btn").text(dialog_no).click(function(){game.closeDialog()}))),i},createActionDiscardDialog:function(n){var t=$("<div>");return t.append($("<h4>").text(dialog_actiondiscard_title)),t.append($("<p>").text(dialog_actiondiscard_text)),t.append($("<br>")),t.append($("<div>").addClass("btnPanel clearfix").append($("<div>").addClass("btn leftAligned").text(dialog_yes).click(function(){game.closeDialog();n()})).append($("<div>").addClass("btn").text(dialog_no).click(function(){game.closeDialog()}))),t},createForcedDiscardDialog:function(n,t,i,r,u){function s(u){for(u.empty(),u.append($("<h4>").text(dialog_forceddiscard_title)),u.append($("<p>").text(dialog_forceddiscard_text)),f=0,o=n.length;f<o;f++)n[f]===t||n[f]===i||n[f]===r||n[f].hasType(ItemType.POTION)||h(u,n[f],f)}function h(n,t,i){n.append($("<img>").attr("src","img/"+t.getImageName()).addClass("item discardable clickable shadowed").click(function(){u(i)?s(n):game.closeDialog(null,!0)}))}var e,f,o;return e=$("<div>"),s(e),e},createOtherPlayerDialog:function(n){var t=$("<div>");return t.append(n.renderOther()),t.append($("<div>").addClass("btn topSpace").text(dialog_close).click(function(){game.closeDialog()})),t},createMissionCardDialog:function(n){var t=$("<div>");return t.append(n.renderMissionCards()),t.append($("<div>").addClass("btn topSpace").text(dialog_close).click(function(){game.closeDialog()})),t},createGuideDialog:function(){var n=$("<div>");return n.append($("<img>").attr("src","img/guide.jpg").addClass("shadowed")),n.append($("<div>").addClass("btn topSpace").text(dialog_close).click(function(){game.closeDialog()})),n},createAlchemyGuideDialog:function(){var n=$("<div>");return n.append($("<img>").attr("src","img/guide_alchemy.jpg").addClass("shadowed")),n.append($("<div>").addClass("btn topSpace").text(dialog_close).click(function(){game.closeDialog()})),n},appendContactSubDialog:function(n,t,i){var r=$("<div>").addClass("contact");r.append($("<label>").text(dialog_contact_email).attr("for","emailField"));r.append($("<input>").attr("name","emailField").attr("id","emailField"));r.append($("<label>").text(dialog_contact_message).attr("for","messageField"));r.append($("<textarea>").attr("name","messageField").attr("id","messageField"));r.append($("<div>").addClass("btnPanel clearfix").append($("<div>").addClass("btn leftAligned").text(dialog_cancel).click(function(){game.closeDialog()}).toggle(i)).append($("<div>").addClass("btn").text(dialog_contact_send).click(function(){var n=/\S+@\S+\.\S+/.test($("#emailField").val());$("#emailField").toggleClass("error",!n);n=n&&$("#messageField").val();$("#messageField").toggleClass("error",!$("#messageField").val());n&&($.ajax({type:"POST",url:"https://mandrillapp.com/api/1.0/messages/send.json",data:{key:"2p9ukdHF9Df6LW7p0KHAIA",message:{subject:"Heldentaufe Feedback",text:$("#messageField").val(),from_email:$("#emailField").val(),to:[{email:"kalinbas@gmail.com"},{email:"simonjunker@gmx.ch"}]}}}),t())})));n.append(r)},createContactDialog:function(){var n=$("<div>");return n.append($("<h4>").text(dialog_contact_title)),n.append($("<p>").html(dialog_contact_text)),Dialog.appendContactSubDialog(n,function(){game.closeDialog()},!0),n},createPlayerSelectionDialog:function(){var t=function(){($(".player.selected").length<5||$(this).hasClass("selected"))&&$(this).toggleClass("selected");$("#startButton").toggleClass("disabled",$(".player.selected").length<2);$("#startButton").attr("title",$(".player.selected").length<2?dialog_selectplayer_button_noready_title:"")},i=function(){if($(".player.selected").length>=2){var n=[];$(".player.selected").each(function(t,i){n.push(parseInt($(i).data("id"),10))});game.closeDialog(n)}},n=$("<div>");return n.append($("<h4>").text(dialog_selectplayer_title)),n.append($("<p>").html(dialog_selectplayer_text)),n.append($("<p>").html(dialog_selectplayer_text2)),n.append($("<div>").addClass("clearfix").append($("<div>").addClass("player").data("id","1").append($("<img>").attr("title",$.i18n.prop(PlayerType.JUPANILLIA.descriptionKey)).attr("src","img/"+PlayerType.JUPANILLIA.portraitImage).attr("height","140")).click(t)).append($("<div>").addClass("player").data("id","2").append($("<img>").attr("title",$.i18n.prop(PlayerType.OLOFPAK.descriptionKey)).attr("src","img/"+PlayerType.OLOFPAK.portraitImage).attr("height","140")).click(t)).append($("<div>").addClass("player").data("id","3").append($("<img>").attr("title",$.i18n.prop(PlayerType.NATHANIEL.descriptionKey)).attr("src","img/"+PlayerType.NATHANIEL.portraitImage).attr("height","140")).click(t)).append($("<div>").addClass("player").data("id","4").append($("<img>").attr("title",$.i18n.prop(PlayerType.GULANZOR.descriptionKey)).attr("src","img/"+PlayerType.GULANZOR.portraitImage).attr("height","140")).click(t)).append($("<div>").addClass("player").data("id","5").append($("<img>").attr("title",$.i18n.prop(PlayerType.LUPHIUS.descriptionKey)).attr("src","img/"+PlayerType.LUPHIUS.portraitImage).attr("height","140")).click(t))),n.append($("<br>")),n.append($("<div>").attr("title",dialog_selectplayer_button_noready_title).addClass("btn disabled").attr("id","startButton").text(dialog_selectplayer_button).click(function(){i()})),n},createWinDialog:function(n){var t,i=$("<div>").addClass("winDialog"),r;for(i.append($("<h4>").text(dialog_win_title)),t=n.length;t--;)i.append($("<img>").addClass("dialogTileSmall").attr("src","img/"+n[t].getPortraitImage()));for(r=$("<p>"),t=n.length;t--;)r.append($("<b>").text(dialog_win_text_winner(n[t].getName(),n[t].getPoints()))).append($("<br>"));return i.append(r),i.append($("<p>").html(dialog_win_text)),i.append($("<div>").addClass("btn").attr("id","dialogCloseButton").text(dialog_next).click(function(){game.closeDialog()})),i},createWinDialog2:function(){var n=$("<div>");return n.append($("<img>").addClass("dialogTileSmall").attr("src","img/character3.jpg")),n.append($("<h4>").text(dialog_win2_title)),n.append($("<p>").html(dialog_win2_text)),Dialog.appendContactSubDialog(n,function(){location.href="http://www.heldentaufe.ch"},!1),n}},ItemType={SWORD:{image1:"sword1.png",image2:"sword2.png",image3:"sword3.png",nameKey:"item_sword_name"},BOOT:{image1:"boot1.png",image2:"boot2.png",image3:"boot3.png",nameKey:"item_boot_name"},RING:{image1:"ring1.png",image2:"ring2.png",image3:"ring3.png",nameKey:"item_ring_name"},POTION:{image1:"potion1.png",image2:"potion2.png",image3:"potion3.png",nameKey:"item_potion_name"},MUSHROOM:{image:"mushroom.png",nameKey:"item_mushroom_name"},FISH:{image:"fish.png",nameKey:"item_fish_name"},APPLE:{image:"apple.png",nameKey:"item_apple_name"}},MissionType={MISSION1:{image:"1.jpg",descKey:"transport"},MISSION2:{image:"2.jpg",descKey:"transport"},MISSION3:{image:"3.jpg",descKey:"transport"},MISSION4:{image:"4.jpg",descKey:"transport"},MISSION5:{image:"5.jpg",descKey:"transport"},MISSION6:{image:"6.jpg",descKey:"transport"},MISSION7:{image:"7.jpg",descKey:"observe"},MISSION8:{image:"8.jpg",descKey:"observe"},MISSION9:{image:"9.jpg",descKey:"observe"},MISSION10:{image:"10.jpg",descKey:"hunt"},MISSION11:{image:"11.jpg",descKey:"hunt"},MISSION12:{image:"12.jpg",descKey:"hunt"},MISSION13:{image:"13.jpg",descKey:"transport"},MISSION14:{image:"14.jpg",descKey:"transport"},MISSION15:{image:"15.jpg",descKey:"transport"},MISSION16:{image:"16.jpg",descKey:"transport"},MISSION17:{image:"17.jpg",descKey:"transport"},MISSION18:{image:"18.jpg",descKey:"transport"},MISSION22:{image:"22.jpg",descKey:"disarm"},MISSION23:{image:"23.jpg",descKey:"steal"},MISSION24:{image:"24.jpg",descKey:"helper"},MISSION25:{image:"25.jpg",descKey:"helper"},MISSION26:{image:"26.jpg",descKey:"helper"}},MonsterType={ZIPFLER:{nameKey:"monster_name_zipfler",x:3,y:2,stats:[{lives:2,power:1},{lives:2,power:2},{lives:3,power:2},{lives:3,power:3},{lives:3,power:4}],boardImage:"zipfler_board.jpg",cssClass:"zipfler",tokenImage:"zipfler.png",portraitImage:"zipflerPortrait.jpg",color:"#FBD266"},ULUMUTU:{nameKey:"monster_name_ulumutu",x:0,y:5,stats:[{lives:3,power:0},{lives:3,power:1},{lives:4,power:1},{lives:4,power:2},{lives:4,power:3}],boardImage:"ulumutu_board.jpg",cssClass:"ulumutu",tokenImage:"ulumutu.png",portraitImage:"ulumutuPortrait.jpg",color:"#64665A"},WALLROG:{nameKey:"monster_name_wallrog",x:3,y:5,stats:[{lives:1,power:2},{lives:1,power:3},{lives:2,power:3},{lives:2,power:4},{lives:2,power:5}],boardImage:"wallrog_board.jpg",cssClass:"wallrog",tokenImage:"wallrog.png",portraitImage:"wallrogPortrait.jpg",color:"#EC7166"}},PlayerType={OLOFPAK:{nameKey:"player_name_olofpak",descriptionKey:"player_description_olofpak",lives:5,steps:4,power:1,magic:0,backpackCapacity:3,potionCapacity:1,color:"red",boardImage:"olofpak_board.jpg",cssClass:"olofpak",tokenImage:"olofpak.png",portraitImage:"olofpakPortrait.jpg",color:"#E56459"},JUPANILLIA:{nameKey:"player_name_jupanillia",descriptionKey:"player_description_jupanillia",lives:5,steps:5,power:0,magic:0,backpackCapacity:3,potionCapacity:1,color:"green",boardImage:"jupanillia_board.jpg",cssClass:"jupanillia",tokenImage:"jupanillia.png",portraitImage:"jupanilliaPortrait.jpg",color:"#9B709B"},GULANZOR:{nameKey:"player_name_gulanzor",descriptionKey:"player_description_gulanzor",lives:5,steps:4,power:0,magic:1,backpackCapacity:3,potionCapacity:1,color:"blue",boardImage:"gulanzor_board.jpg",cssClass:"gulanzor",tokenImage:"gulanzor.png",portraitImage:"gulanzorPortrait.jpg",color:"#D19642"},LUPHIUS:{nameKey:"player_name_luphius",descriptionKey:"player_description_luphius",lives:4,steps:4,power:0,magic:0,backpackCapacity:5,potionCapacity:1,color:"yellow",boardImage:"luphius_board.jpg",cssClass:"luphius",tokenImage:"luphius.png",portraitImage:"luphiusPortrait.jpg",color:"#837832"},NATHANIEL:{nameKey:"player_name_nathaniel",descriptionKey:"player_description_nathaniel",lives:7,steps:4,power:0,magic:0,backpackCapacity:3,potionCapacity:1,color:"white",boardImage:"nathaniel_board.jpg",cssClass:"nathaniel",tokenImage:"nathaniel.png",portraitImage:"nathanielPortrait.jpg",color:"#AAC1DE"},MONSTERPLAYER:{nameKey:"player_name_monsterplayer",lives:1,steps:4,power:0,magic:0,backpackCapacity:0,boardImage:"monsterplayer.jpg",portraitImage:"monsterPortrait.jpg"}},TileType={VILLAGE:{name:"VILLAGE",image:"village.png"},GRASS:{name:"GRASS",image:"grass.png"},FOREST:{name:"FOREST",image:"forest.png"},CASTLE:{name:"CASTLE",image:"castle.png"},TRADER:{name:"TRADER",image:"trader.png"},SMITH:{name:"SMITH",image:"smith.png"},MUSHROOM:{name:"MUSHROOM",image:"resource1.png"},FISH:{name:"FISH",image:"resource2.png"},APPLE:{name:"APPLE",image:"resource3.png"},DUNGEON1:{name:"DUNGEON",image:"dungeon1.png"},DUNGEON2:{name:"DUNGEON",image:"dungeon2.png"},DUNGEON3:{name:"DUNGEON",image:"dungeon3.png"},DUNGEON4:{name:"DUNGEON",image:"dungeon4.png"},DUNGEON5:{name:"DUNGEON",image:"dungeon5.png"},DUNGEONFLOOR:{name:"DUNGEONFLOOR",image:"dungeonfloor.png"},DUNGEONEXIT1:{name:"DUNGEONEXIT",image:"dungeonexit1.png"},DUNGEONEXIT2:{name:"DUNGEONEXIT",image:"dungeonexit2.png"},DUNGEONEXIT3:{name:"DUNGEONEXIT",image:"dungeonexit3.png"},DUNGEONEXIT4:{name:"DUNGEONEXIT",image:"dungeonexit4.png"},DUNGEONEXIT5:{name:"DUNGEONEXIT",image:"dungeonexit5.png"},DUNGEONTREASURE:{name:"DUNGEONTREASURE",image:"dungeonfloor.png"},DUNGEONTRAP:{name:"DUNGEONTRAP",image:"dungeonfloor.png"}},TutorialStep={SETUP_CONTACT:{ressourceKey:"setup_contact",isSetup:!0},SETUP_STARTPIECE:{ressourceKey:"setup_startpiece",isSetup:!0},SETUP_DUNGEON:{ressourceKey:"setup_dungeon",isSetup:!0},SETUP_TRAPS:{ressourceKey:"setup_traps",isSetup:!0},SETUP_TREASURE:{ressourceKey:"setup_treasure",isSetup:!0},SETUP_MONSTERTOKEN:{ressourceKey:"setup_monstertoken",isSetup:!0},SETUP_MONSTERCARDS:{ressourceKey:"setup_monstercards",isSetup:!0},SETUP_MONSTERTEETH:{ressourceKey:"setup_monsterteeth",isSetup:!0},SETUP_MONSTERHEARTS:{ressourceKey:"setup_monsterhearts",isSetup:!0},SETUP_PLAYERCARDS:{ressourceKey:"setup_playercards",isSetup:!0},SETUP_PLAYERHEARTS:{ressourceKey:"setup_playerhearts",isSetup:!0},SETUP_PLAYERTOKEN:{ressourceKey:"setup_playertoken",isSetup:!0},SETUP_MISSIONCARDS:{ressourceKey:"setup_missioncards",isSetup:!0},SETUP_PLAYERPOINTS:{ressourceKey:"setup_playerpoints",isSetup:!0},SETUP_ACTIONPOINTS:{ressourceKey:"setup_actionpoints",isSetup:!0},SETUP_MISSIONBUTTON:{ressourceKey:"setup_missionbutton",isSetup:!0},SETUP_ALCHEMY:{ressourceKey:"setup_alchemy",isSetup:!0},SETUP_OTHERPLAYERS:{ressourceKey:"setup_otherplayers"},SETUP_GUIDE:{ressourceKey:"setup_guide"},STEP_MOVEMENT:{ressourceKey:"step_movement",noCloseButton:!0},STEP_NOSTEPSLEFT:{ressourceKey:"step_nostepsleft",hasTitle:!0},STEP_MONSTERPLAYER:{ressourceKey:"step_monsterplayer"},STEP_MONSTERPLAYERTURN:{ressourceKey:"step_monsterplayerturn"},STEP_MONSTERPLAYERTURN2:{ressourceKey:"step_monsterplayerturn2"},STEP_NEXTPLAYER:{ressourceKey:"step_nextplayer"},STEP_LASTTILE:{ressourceKey:"step_lasttile",hasTitle:!0},STEP_BOOTFOUND:{ressourceKey:"step_bootfound",hasTitle:!0},STEP_SWORDFOUND:{ressourceKey:"step_swordfound",hasTitle:!0},STEP_RINGFOUND:{ressourceKey:"step_ringfound",hasTitle:!0},STEP_FOODAVAILABLE:{ressourceKey:"step_foodavailable",hasTitle:!0},STEP_POTIONAVAILABLE:{ressourceKey:"step_potionavailable",hasTitle:!0},STEP_MISSIONAVAILABLE:{ressourceKey:"step_missionavailable",hasTitle:!0},STEP_INVENTORYFULL:{ressourceKey:"step_inventoryfull",hasTitle:!0},STEP_POTIONCREATED:{ressourceKey:"step_potioncreated",hasTitle:!0},STEP_NOTRAP:{ressourceKey:"step_notrap",hasTitle:!0},STEP_LOSTLIFESDEF:{ressourceKey:"step_lostlifesdef",inFront:!0},STEP_LOSTLIFESATT:{ressourceKey:"step_lostlifesatt",inFront:!0},STEP_FEWLIFES:{ressourceKey:"step_fewlifes",inFront:!0},STEP_PVP:{ressourceKey:"step_pvp"},STEP_ALLPVP:{ressourceKey:"step_allpvp"},STEP_MONSTERKILLED:{ressourceKey:"step_monsterkilled"},STEP_BERSERKER:{ressourceKey:"step_berserker"},STEP_TELEPORT:{ressourceKey:"step_teleport"},STEP_FIRSTTEETHCOLLECTED:{ressourceKey:"step_firstteethcollected",hasTitle:!0},STEP_TEETHCOLLECTED:{ressourceKey:"step_teethcollected",hasTitle:!0},STEP_LASTHEROLEAVESDUNGEON:{ressourceKey:"step_lastheroleavesdungeon"},FIELD_DUNGEON:{ressourceKey:"fields_dungeon",hasTitle:!0},FIELD_DUNGEONEXIT:{ressourceKey:"fields_dungeonexit",hasTitle:!0},FIELDS:{}},Utils,game,loader;TutorialStep.FIELDS[TileType.GRASS.name]={ressourceKey:"fields_grass",hasTitle:!0};TutorialStep.FIELDS[TileType.CASTLE.name]={ressourceKey:"fields_castle",hasTitle:!0};TutorialStep.FIELDS[TileType.TRADER.name]={ressourceKey:"fields_trader",hasTitle:!0};TutorialStep.FIELDS[TileType.SMITH.name]={ressourceKey:"fields_smith",hasTitle:!0};TutorialStep.FIELDS[TileType.APPLE.name]={ressourceKey:"fields_apple",hasTitle:!0};TutorialStep.FIELDS[TileType.MUSHROOM.name]={ressourceKey:"fields_mushroom",hasTitle:!0};TutorialStep.FIELDS[TileType.FISH.name]={ressourceKey:"fields_fish",hasTitle:!0};TutorialStep.FIELDS[TileType.DUNGEON1.name]=TutorialStep.FIELD_DUNGEON;TutorialStep.FIELDS[TileType.DUNGEONEXIT1.name]=TutorialStep.FIELD_DUNGEONEXIT;TutorialStep.FIELDS[TileType.DUNGEON2.name]=TutorialStep.FIELD_DUNGEON;TutorialStep.FIELDS[TileType.DUNGEONEXIT2.name]=TutorialStep.FIELD_DUNGEONEXIT;TutorialStep.FIELDS[TileType.DUNGEON3.name]=TutorialStep.FIELD_DUNGEON;TutorialStep.FIELDS[TileType.DUNGEONEXIT3.name]=TutorialStep.FIELD_DUNGEONEXIT;TutorialStep.FIELDS[TileType.DUNGEON4.name]=TutorialStep.FIELD_DUNGEON;TutorialStep.FIELDS[TileType.DUNGEONEXIT4.name]=TutorialStep.FIELD_DUNGEONEXIT;TutorialStep.FIELDS[TileType.DUNGEON5.name]=TutorialStep.FIELD_DUNGEON;TutorialStep.FIELDS[TileType.DUNGEONEXIT5.name]=TutorialStep.FIELD_DUNGEONEXIT;Utils={randomizeArray:function(n){for(var t=n.length,r,i;0!==t;)i=Math.floor(Math.random()*t),t-=1,r=n[t],n[t]=n[i],n[i]=r;return n},setDefaultCursor:function(){document.body.style.cursor="default"},setWalkCursor:function(){document.body.style.cursor="pointer"},setActionCursor:function(){document.body.style.cursor="pointer"},setTeleportCursor:function(){document.body.style.cursor="crosshair"},setAttackCursor:function(){document.body.style.cursor="pointer"},setMonsterSelectCursor:function(){document.body.style.cursor="pointer"},getRandomNumber:function(n,t){return Math.floor(Math.random()*(t-n+1)+n)},getDateDiffInMinutes:function(n,t){var i=Math.abs(n-t);return Math.floor(i/6e4)},runDice:function(n,t,i){function r(t,i){$(n).removeClass("dice1 dice2 dice3 dice4 dice5 dice6");$(n).addClass("dice"+t);i?$(n).addClass("running"):$(n).removeClass("running")}var u=setInterval(function(){var n=new Date;r(n.getTime()%6+1,!0)},50);$(n).on("click",function(){$(n).off("click");clearInterval(u);r(t,!1);i()})},getParameterByName:function(n){var t=RegExp("[?&]"+n+"=([^&]*)").exec(window.location.search);return t&&decodeURIComponent(t[1].replace(/\+/g," "))}},function(){loader=new Loader;var n=$(window).width()<980||$(window).height()<540,t=!Modernizr.canvas||!Modernizr.opacity||$("html").hasClass("lt-ie10"),i=n||t,r=Utils.getParameterByName("lang")||"de";loader.init(r,i,function(){i?(t?($("#errorScreen .line1").html(loading_error_wrongbrowser_line1),$("#errorScreen .line2").html(loading_error_wrongbrowser_line2)):n&&($("#errorScreen .line1").html(loading_error_tosmallscreen_line1),$("#errorScreen .line2").html(loading_error_tosmallscreen_line2)),$("#loading").hide(),$("#errorScreen").show()):($("#loading").hide(),$("#container").show(),game=new Game,game.init())},function(n){var t=$("#loadingStatus");t.width(900*(1-n))})}();